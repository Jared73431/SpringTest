2025-06-05 11:08:16 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Starting SpringWebsocket3Application using Java 17.0.11 with PID 46796 (D:\WorkSpace\SpringTset\SpringTest\Spring_Websocket3\build\classes\java\main started by Jared in D:\WorkSpace\SpringTset\SpringTest)
2025-06-05 11:08:16 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - No active profile set, falling back to 1 default profile: "default"
2025-06-05 11:08:16 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-06-05 11:08:16 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JDBC repositories in DEFAULT mode.
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 24 ms. Found 0 JDBC repository interfaces.
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 66 ms. Found 2 JPA repository interfaces.
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 11:08:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 2 ms. Found 0 Redis repository interfaces.
2025-06-05 11:08:18 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8015 (http)
2025-06-05 11:08:18 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-05 11:08:18 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.41]
2025-06-05 11:08:18 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-05 11:08:18 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1607 ms
2025-06-05 11:08:18 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-05 11:08:19 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.15.Final
2025-06-05 11:08:19 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-05 11:08:19 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-05 11:08:19 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-05 11:08:19 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7a8c9792
2025-06-05 11:08:19 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-05 11:08:19 [restartedMain] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-05 11:08:19 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 16.3
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-06-05 11:08:20 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-05 11:08:20 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-05 11:08:20 [restartedMain] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-05 11:08:21 [restartedMain] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-06-05 11:08:21 [restartedMain] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-05 11:08:22 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.ChatRoomController:
	
2025-06-05 11:08:22 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.FileUploadController:
	
2025-06-05 11:08:22 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.WebController:
	
2025-06-05 11:08:22 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-06-05 11:08:22 [restartedMain] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page template: index
2025-06-05 11:08:22 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-06-05 11:08:22 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-05 11:08:22 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@6870de72]]
2025-06-05 11:08:22 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-05 11:08:22 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8015 (http) with context path '/'
2025-06-05 11:08:22 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Started SpringWebsocket3Application in 6.65 seconds (process running for 7.0)
2025-06-05 11:08:31 [http-nio-8015-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-05 11:08:31 [http-nio-8015-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-05 11:08:31 [http-nio-8015-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-05 11:08:43 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@78976e6e
2025-06-05 11:08:43 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749092923925
2025-06-05 11:08:43 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@78976e6e
2025-06-05 11:08:43 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/332/e34fsduc/websocket
2025-06-05 11:08:43 [http-nio-8015-exec-5] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=e34fsduc]
2025-06-05 11:08:44 [clientOutboundChannel-1] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 11:08:44 [clientInboundChannel-7] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=e34fsduc, lookupDestination='/chat.joinRoom'
2025-06-05 11:08:44 [clientInboundChannel-7] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - No matching message handler methods.
2025-06-05 11:08:44 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 11:08:44 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.created_at 
    fetch
        first ? rows only
2025-06-05 11:08:44 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 11:08:44 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 11:09:08 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@78976e6e
2025-06-05 11:09:08 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749092948022
2025-06-05 11:09:08 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@78976e6e
2025-06-05 11:09:08 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/468/xiaspzrm/websocket
2025-06-05 11:09:08 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=xiaspzrm]
2025-06-05 11:09:08 [clientOutboundChannel-2] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 11:09:08 [clientInboundChannel-16] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=xiaspzrm, lookupDestination='/chat.joinRoom'
2025-06-05 11:09:08 [clientInboundChannel-16] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - No matching message handler methods.
2025-06-05 11:09:08 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 11:09:11 [http-nio-8015-exec-8] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=xiaspzrm] closed with CloseStatus[code=1000, reason=null]
2025-06-05 11:09:11 [http-nio-8015-exec-8] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session xiaspzrm
2025-06-05 11:09:11 [clientOutboundChannel-3] DEBUG o.s.w.s.m.StompSubProtocolHandler - Failed to send WebSocket message to client in session xiaspzrm
java.lang.IllegalStateException: Cannot send a message when session is closed
	at org.springframework.util.Assert.state(Assert.java:79)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.sendMessage(AbstractSockJsSession.java:144)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.tryFlushMessageBuffer(ConcurrentWebSocketSessionDecorator.java:190)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.sendMessage(ConcurrentWebSocketSessionDecorator.java:163)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.sendToClient(StompSubProtocolHandler.java:529)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.handleMessageToClient(StompSubProtocolHandler.java:516)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.handleMessage(SubProtocolWebSocketHandler.java:387)
	at org.springframework.messaging.support.ExecutorSubscribableChannel$SendTask.run(ExecutorSubscribableChannel.java:152)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-06-05 11:09:11 [clientOutboundChannel-4] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=xiaspzrm}], simpSessionId=xiaspzrm}]
2025-06-05 11:09:16 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@78976e6e
2025-06-05 11:09:16 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749092956769
2025-06-05 11:09:16 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@78976e6e
2025-06-05 11:09:16 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/977/bc4mw5wn/websocket
2025-06-05 11:09:16 [http-nio-8015-exec-2] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=bc4mw5wn]
2025-06-05 11:09:16 [clientOutboundChannel-5] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 11:09:16 [clientInboundChannel-31] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=bc4mw5wn, lookupDestination='/chat.joinRoom'
2025-06-05 11:09:16 [clientInboundChannel-31] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - No matching message handler methods.
2025-06-05 11:09:16 [http-nio-8015-exec-5] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 11:09:18 [MessageBroker-8] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [xiaspzrm]
2025-06-05 11:09:22 [MessageBroker-4] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 3 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(3)-CONNECTED(3)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 33, active threads = 0, queued tasks = 0, completed tasks = 33], outboundChannel[pool size = 5, active threads = 0, queued tasks = 0, completed tasks = 5], sockJsScheduler[pool size = 17, active threads = 1, queued tasks = 3, completed tasks = 9]
2025-06-05 11:09:28 [clientInboundChannel-34] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=bc4mw5wn, lookupDestination='/chat.sendMessage'
2025-06-05 11:09:28 [clientInboundChannel-34] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - No matching message handler methods.
2025-06-05 11:09:33 [clientInboundChannel-37] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=e34fsduc, lookupDestination='/chat.sendMessage'
2025-06-05 11:09:33 [clientInboundChannel-37] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - No matching message handler methods.
2025-06-05 11:37:01 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Starting SpringWebsocket3Application using Java 17.0.11 with PID 47528 (D:\WorkSpace\SpringTset\SpringTest\Spring_Websocket3\build\classes\java\main started by Jared in D:\WorkSpace\SpringTset\SpringTest)
2025-06-05 11:37:01 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - No active profile set, falling back to 1 default profile: "default"
2025-06-05 11:37:01 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-06-05 11:37:01 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-06-05 11:37:01 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 11:37:01 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JDBC repositories in DEFAULT mode.
2025-06-05 11:37:01 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 11:37:01 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 11:37:01 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 29 ms. Found 0 JDBC repository interfaces.
2025-06-05 11:37:01 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 11:37:01 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-05 11:37:01 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 64 ms. Found 2 JPA repository interfaces.
2025-06-05 11:37:02 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 11:37:02 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-06-05 11:37:02 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 11:37:02 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 11:37:02 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 2 ms. Found 0 Redis repository interfaces.
2025-06-05 11:37:02 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8015 (http)
2025-06-05 11:37:02 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-05 11:37:02 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.41]
2025-06-05 11:37:02 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-05 11:37:02 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1494 ms
2025-06-05 11:37:03 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-05 11:37:03 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.15.Final
2025-06-05 11:37:03 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-05 11:37:03 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-05 11:37:03 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-05 11:37:03 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3852cd5d
2025-06-05 11:37:03 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-05 11:37:04 [restartedMain] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-05 11:37:04 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 16.3
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-06-05 11:37:04 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-05 11:37:04 [restartedMain] DEBUG org.hibernate.SQL - 
    create table chat_messages (
        id bigint generated by default as identity,
        content TEXT,
        created_at timestamp(6) not null,
        file_name varchar(255),
        file_size bigint,
        file_type varchar(255),
        file_url varchar(255),
        room_id varchar(255) not null,
        sender varchar(50) not null,
        timestamp bigint,
        message_type varchar(255) not null check (message_type in ('CHAT','JOIN','LEAVE','FILE','IMAGE','DOCUMENT')),
        updated_at timestamp(6),
        primary key (id)
    )
2025-06-05 11:37:04 [restartedMain] DEBUG org.hibernate.SQL - 
    create table chat_rooms (
        id bigint generated by default as identity,
        created_at timestamp(6) not null,
        creator varchar(50) not null,
        description varchar(500),
        is_active boolean not null,
        member_count integer not null,
        name varchar(100) not null,
        updated_at timestamp(6),
        primary key (id)
    )
2025-06-05 11:37:04 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table if exists chat_rooms 
       drop constraint if exists UK3ducf4em5bvxbtmo2s2xvj10c
2025-06-05 11:37:04 [restartedMain] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-06-05 11:37:04 [restartedMain] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "uk3ducf4em5bvxbtmo2s2xvj10c" of relation "chat_rooms" does not exist, skipping
2025-06-05 11:37:04 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table if exists chat_rooms 
       add constraint UK3ducf4em5bvxbtmo2s2xvj10c unique (name)
2025-06-05 11:37:04 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-05 11:37:04 [restartedMain] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-05 11:37:06 [restartedMain] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-06-05 11:37:06 [restartedMain] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-05 11:37:06 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.ChatRoomController:
	
2025-06-05 11:37:06 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.ChatWebSocketController:
	{[MESSAGE],[/chat.sendMessage]}: sendMessage(ChatMessage)
	{[MESSAGE],[/chat.joinRoom]}: joinRoom(ChatMessage,SimpMessageHeaderAccessor)
	{[MESSAGE],[/chat.leaveRoom]}: leaveRoom(ChatMessage)
2025-06-05 11:37:06 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.FileUploadController:
	
2025-06-05 11:37:06 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.WebController:
	
2025-06-05 11:37:06 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-06-05 11:37:06 [restartedMain] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page template: index
2025-06-05 11:37:06 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-06-05 11:37:06 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-05 11:37:06 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@13b28d4f]]
2025-06-05 11:37:06 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-05 11:37:06 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8015 (http) with context path '/'
2025-06-05 11:37:06 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Started SpringWebsocket3Application in 6.329 seconds (process running for 6.691)
2025-06-05 11:37:07 [http-nio-8015-exec-2] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-05 11:37:07 [http-nio-8015-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-05 11:37:07 [http-nio-8015-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-05 11:37:07 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@798e4b37
2025-06-05 11:37:07 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@798e4b37
2025-06-05 11:37:07 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749094626893
2025-06-05 11:37:07 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749094626892
2025-06-05 11:37:07 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@798e4b37
2025-06-05 11:37:07 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/869/czpwbwwq/websocket
2025-06-05 11:37:07 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=czpwbwwq]
2025-06-05 11:37:07 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@798e4b37
2025-06-05 11:37:07 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/528/svqhxegw/websocket
2025-06-05 11:37:07 [http-nio-8015-exec-4] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=svqhxegw]
2025-06-05 11:37:07 [clientOutboundChannel-1] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 11:37:07 [clientOutboundChannel-2] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 11:37:07 [clientInboundChannel-13] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=czpwbwwq, lookupDestination='/chat.joinRoom'
2025-06-05 11:37:07 [clientInboundChannel-14] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=svqhxegw, lookupDestination='/chat.joinRoom'
2025-06-05 11:37:07 [clientInboundChannel-14] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 11:37:07 [clientInboundChannel-13] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 11:37:07 [clientInboundChannel-13] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 11:37:07 [clientInboundChannel-14] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 11:37:07 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 11:37:07 [clientInboundChannel-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 11:37:07 [clientInboundChannel-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 11:37:07 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 11:37:07 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T11:37:07.411554600]
2025-06-05 11:37:07 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 11:37:07 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T11:37:07.412096900]
2025-06-05 11:37:07 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 11:37:07 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 11:37:07 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 11:37:07 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 11:37:07 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 11:37:07 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 11:37:07 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 11:37:07 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 11:37:07 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749094627394]
2025-06-05 11:37:07 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 11:37:07 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 11:37:07 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 11:37:07 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 11:37:07 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 11:37:07 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T11:37:07.412096900]
2025-06-05 11:37:07 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749094627394]
2025-06-05 11:37:07 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 11:37:07 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T11:37:07.411554600]
2025-06-05 11:37:07 [http-nio-8015-exec-10] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 11:37:07 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.created_at 
    fetch
        first ? rows only
2025-06-05 11:37:07 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 11:37:07 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 11:37:07 [http-nio-8015-exec-9] ERROR c.e.d.controller.ChatRoomController - 获取聊天室消息失败: 1
org.springframework.data.redis.serializer.SerializationException: Cannot serialize
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:98)
	at org.springframework.data.redis.serializer.DefaultRedisElementWriter.write(DefaultRedisElementWriter.java:42)
	at org.springframework.data.redis.serializer.RedisSerializationContext$SerializationPair.write(RedisSerializationContext.java:292)
	at org.springframework.data.redis.cache.RedisCache.serializeCacheValue(RedisCache.java:343)
	at org.springframework.data.redis.cache.RedisCache.put(RedisCache.java:204)
	at org.springframework.cache.interceptor.AbstractCacheInvoker.doPut(AbstractCacheInvoker.java:157)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.performCachePut(CacheAspectSupport.java:1087)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.apply(CacheAspectSupport.java:1072)
	at org.springframework.cache.interceptor.CacheAspectSupport.evaluate(CacheAspectSupport.java:616)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:448)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:410)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:65)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at com.example.demo.service.ChatMessageService$$SpringCGLIB$$0.getRecentMessages(<generated>)
	at com.example.demo.controller.ChatRoomController.getMessages(ChatRoomController.java:169)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to serialize object using DefaultSerializer
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:64)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:33)
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:96)
	... 65 common frames omitted
Caused by: java.io.NotSerializableException: com.example.demo.entity.ChatMessage
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at java.base/java.util.ArrayList.writeObject(ArrayList.java:866)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1074)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1526)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at org.springframework.core.serializer.DefaultSerializer.serialize(DefaultSerializer.java:46)
	at org.springframework.core.serializer.Serializer.serializeToByteArray(Serializer.java:56)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:60)
	... 67 common frames omitted
2025-06-05 11:37:07 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.created_at 
    fetch
        first ? rows only
2025-06-05 11:37:07 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 11:37:07 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 11:37:07 [http-nio-8015-exec-2] ERROR c.e.d.controller.ChatRoomController - 获取聊天室消息失败: 1
org.springframework.data.redis.serializer.SerializationException: Cannot serialize
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:98)
	at org.springframework.data.redis.serializer.DefaultRedisElementWriter.write(DefaultRedisElementWriter.java:42)
	at org.springframework.data.redis.serializer.RedisSerializationContext$SerializationPair.write(RedisSerializationContext.java:292)
	at org.springframework.data.redis.cache.RedisCache.serializeCacheValue(RedisCache.java:343)
	at org.springframework.data.redis.cache.RedisCache.put(RedisCache.java:204)
	at org.springframework.cache.interceptor.AbstractCacheInvoker.doPut(AbstractCacheInvoker.java:157)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.performCachePut(CacheAspectSupport.java:1087)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.apply(CacheAspectSupport.java:1072)
	at org.springframework.cache.interceptor.CacheAspectSupport.evaluate(CacheAspectSupport.java:616)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:448)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:410)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:65)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at com.example.demo.service.ChatMessageService$$SpringCGLIB$$0.getRecentMessages(<generated>)
	at com.example.demo.controller.ChatRoomController.getMessages(ChatRoomController.java:169)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to serialize object using DefaultSerializer
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:64)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:33)
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:96)
	... 65 common frames omitted
Caused by: java.io.NotSerializableException: com.example.demo.entity.ChatMessage
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at java.base/java.util.ArrayList.writeObject(ArrayList.java:866)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1074)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1526)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at org.springframework.core.serializer.DefaultSerializer.serialize(DefaultSerializer.java:46)
	at org.springframework.core.serializer.Serializer.serializeToByteArray(Serializer.java:56)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:60)
	... 67 common frames omitted
2025-06-05 11:37:19 [http-nio-8015-exec-1] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=svqhxegw] closed with CloseStatus[code=1000, reason=null]
2025-06-05 11:37:19 [http-nio-8015-exec-1] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session svqhxegw
2025-06-05 11:37:19 [http-nio-8015-exec-1] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 11:37:19 [clientOutboundChannel-7] DEBUG o.s.w.s.m.StompSubProtocolHandler - Failed to send WebSocket message to client in session svqhxegw
java.lang.IllegalStateException: Cannot send a message when session is closed
	at org.springframework.util.Assert.state(Assert.java:79)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.sendMessage(AbstractSockJsSession.java:144)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.tryFlushMessageBuffer(ConcurrentWebSocketSessionDecorator.java:190)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.sendMessage(ConcurrentWebSocketSessionDecorator.java:163)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.sendToClient(StompSubProtocolHandler.java:529)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.handleMessageToClient(StompSubProtocolHandler.java:516)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.handleMessage(SubProtocolWebSocketHandler.java:387)
	at org.springframework.messaging.support.ExecutorSubscribableChannel$SendTask.run(ExecutorSubscribableChannel.java:152)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-06-05 11:37:19 [clientOutboundChannel-8] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=svqhxegw}], simpSessionId=svqhxegw}]
2025-06-05 11:37:19 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@798e4b37
2025-06-05 11:37:19 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749094639902
2025-06-05 11:37:19 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@798e4b37
2025-06-05 11:37:19 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/692/h2eqi2f4/websocket
2025-06-05 11:37:19 [http-nio-8015-exec-5] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=h2eqi2f4]
2025-06-05 11:37:20 [clientOutboundChannel-9] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 11:37:20 [clientInboundChannel-31] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=h2eqi2f4, lookupDestination='/chat.joinRoom'
2025-06-05 11:37:20 [clientInboundChannel-31] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 11:37:20 [clientInboundChannel-31] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 11:37:20 [clientInboundChannel-31] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 11:37:20 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 11:37:20 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T11:37:20.029920800]
2025-06-05 11:37:20 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 11:37:20 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 11:37:20 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 11:37:20 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 11:37:20 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 11:37:20 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 11:37:20 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749094640028]
2025-06-05 11:37:20 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 11:37:20 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T11:37:20.029920800]
2025-06-05 11:37:20 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 11:37:20 [http-nio-8015-exec-10] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.created_at 
    fetch
        first ? rows only
2025-06-05 11:37:20 [http-nio-8015-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 11:37:20 [http-nio-8015-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 11:37:20 [http-nio-8015-exec-10] ERROR c.e.d.controller.ChatRoomController - 获取聊天室消息失败: 1
org.springframework.data.redis.serializer.SerializationException: Cannot serialize
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:98)
	at org.springframework.data.redis.serializer.DefaultRedisElementWriter.write(DefaultRedisElementWriter.java:42)
	at org.springframework.data.redis.serializer.RedisSerializationContext$SerializationPair.write(RedisSerializationContext.java:292)
	at org.springframework.data.redis.cache.RedisCache.serializeCacheValue(RedisCache.java:343)
	at org.springframework.data.redis.cache.RedisCache.put(RedisCache.java:204)
	at org.springframework.cache.interceptor.AbstractCacheInvoker.doPut(AbstractCacheInvoker.java:157)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.performCachePut(CacheAspectSupport.java:1087)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.apply(CacheAspectSupport.java:1072)
	at org.springframework.cache.interceptor.CacheAspectSupport.evaluate(CacheAspectSupport.java:616)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:448)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:410)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:65)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at com.example.demo.service.ChatMessageService$$SpringCGLIB$$0.getRecentMessages(<generated>)
	at com.example.demo.controller.ChatRoomController.getMessages(ChatRoomController.java:169)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to serialize object using DefaultSerializer
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:64)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:33)
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:96)
	... 65 common frames omitted
Caused by: java.io.NotSerializableException: com.example.demo.entity.ChatMessage
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at java.base/java.util.ArrayList.writeObject(ArrayList.java:866)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1074)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1526)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at org.springframework.core.serializer.DefaultSerializer.serialize(DefaultSerializer.java:46)
	at org.springframework.core.serializer.Serializer.serializeToByteArray(Serializer.java:56)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:60)
	... 67 common frames omitted
2025-06-05 11:37:21 [http-nio-8015-exec-2] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=h2eqi2f4] closed with CloseStatus[code=1000, reason=null]
2025-06-05 11:37:21 [http-nio-8015-exec-2] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session h2eqi2f4
2025-06-05 11:37:21 [http-nio-8015-exec-2] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 11:37:21 [clientOutboundChannel-12] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@570b4951, simpSessionId=h2eqi2f4}], simpSessionId=h2eqi2f4}]
2025-06-05 11:37:21 [clientOutboundChannel-13] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=h2eqi2f4}], simpSessionId=h2eqi2f4}]
2025-06-05 11:37:21 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@798e4b37
2025-06-05 11:37:21 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749094641786
2025-06-05 11:37:21 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@798e4b37
2025-06-05 11:37:21 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/457/dmhodskb/websocket
2025-06-05 11:37:21 [http-nio-8015-exec-5] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=dmhodskb]
2025-06-05 11:37:21 [clientOutboundChannel-14] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 11:37:21 [clientInboundChannel-46] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=dmhodskb, lookupDestination='/chat.joinRoom'
2025-06-05 11:37:21 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 11:37:21 [clientInboundChannel-46] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 11:37:21 [clientInboundChannel-46] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 11:37:21 [clientInboundChannel-46] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 11:37:21 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 11:37:21 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T11:37:21.917754600]
2025-06-05 11:37:21 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 11:37:21 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 11:37:21 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 11:37:21 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 11:37:21 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 11:37:21 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 11:37:21 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749094641917]
2025-06-05 11:37:21 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 11:37:21 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T11:37:21.917754600]
2025-06-05 11:37:21 [http-nio-8015-exec-10] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.created_at 
    fetch
        first ? rows only
2025-06-05 11:37:21 [http-nio-8015-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 11:37:21 [http-nio-8015-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 11:37:21 [http-nio-8015-exec-10] ERROR c.e.d.controller.ChatRoomController - 获取聊天室消息失败: 1
org.springframework.data.redis.serializer.SerializationException: Cannot serialize
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:98)
	at org.springframework.data.redis.serializer.DefaultRedisElementWriter.write(DefaultRedisElementWriter.java:42)
	at org.springframework.data.redis.serializer.RedisSerializationContext$SerializationPair.write(RedisSerializationContext.java:292)
	at org.springframework.data.redis.cache.RedisCache.serializeCacheValue(RedisCache.java:343)
	at org.springframework.data.redis.cache.RedisCache.put(RedisCache.java:204)
	at org.springframework.cache.interceptor.AbstractCacheInvoker.doPut(AbstractCacheInvoker.java:157)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.performCachePut(CacheAspectSupport.java:1087)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.apply(CacheAspectSupport.java:1072)
	at org.springframework.cache.interceptor.CacheAspectSupport.evaluate(CacheAspectSupport.java:616)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:448)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:410)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:65)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at com.example.demo.service.ChatMessageService$$SpringCGLIB$$0.getRecentMessages(<generated>)
	at com.example.demo.controller.ChatRoomController.getMessages(ChatRoomController.java:169)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to serialize object using DefaultSerializer
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:64)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:33)
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:96)
	... 65 common frames omitted
Caused by: java.io.NotSerializableException: com.example.demo.entity.ChatMessage
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at java.base/java.util.ArrayList.writeObject(ArrayList.java:866)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1074)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1526)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at org.springframework.core.serializer.DefaultSerializer.serialize(DefaultSerializer.java:46)
	at org.springframework.core.serializer.Serializer.serializeToByteArray(Serializer.java:56)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:60)
	... 67 common frames omitted
2025-06-05 11:37:26 [http-nio-8015-exec-9] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=czpwbwwq] closed with CloseStatus[code=1000, reason=null]
2025-06-05 11:37:26 [http-nio-8015-exec-9] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session czpwbwwq
2025-06-05 11:37:26 [http-nio-8015-exec-9] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 11:37:26 [clientOutboundChannel-17] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@dce56fd, simpSessionId=czpwbwwq}], simpSessionId=czpwbwwq}]
2025-06-05 11:37:26 [clientOutboundChannel-18] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=czpwbwwq}], simpSessionId=czpwbwwq}]
2025-06-05 11:37:27 [MessageBroker-6] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 2 sessions: [h2eqi2f4, svqhxegw]
2025-06-05 11:37:32 [MessageBroker-9] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [czpwbwwq]
2025-06-05 11:37:33 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@798e4b37
2025-06-05 11:37:33 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749094653088
2025-06-05 11:37:33 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@798e4b37
2025-06-05 11:37:33 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/070/pws5vy5n/websocket
2025-06-05 11:37:33 [http-nio-8015-exec-7] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=pws5vy5n]
2025-06-05 11:37:33 [clientOutboundChannel-19] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 11:37:33 [clientInboundChannel-15] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=pws5vy5n, lookupDestination='/chat.joinRoom'
2025-06-05 11:37:33 [clientInboundChannel-15] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 11:37:33 [clientInboundChannel-15] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 11:37:33 [http-nio-8015-exec-10] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 11:37:33 [clientInboundChannel-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 11:37:33 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 11:37:33 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T11:37:33.204290]
2025-06-05 11:37:33 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 11:37:33 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 11:37:33 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 11:37:33 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 11:37:33 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 11:37:33 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 11:37:33 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749094653201]
2025-06-05 11:37:33 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 11:37:33 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T11:37:33.204290]
2025-06-05 11:37:33 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.created_at 
    fetch
        first ? rows only
2025-06-05 11:37:33 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 11:37:33 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 11:37:33 [http-nio-8015-exec-9] ERROR c.e.d.controller.ChatRoomController - 获取聊天室消息失败: 1
org.springframework.data.redis.serializer.SerializationException: Cannot serialize
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:98)
	at org.springframework.data.redis.serializer.DefaultRedisElementWriter.write(DefaultRedisElementWriter.java:42)
	at org.springframework.data.redis.serializer.RedisSerializationContext$SerializationPair.write(RedisSerializationContext.java:292)
	at org.springframework.data.redis.cache.RedisCache.serializeCacheValue(RedisCache.java:343)
	at org.springframework.data.redis.cache.RedisCache.put(RedisCache.java:204)
	at org.springframework.cache.interceptor.AbstractCacheInvoker.doPut(AbstractCacheInvoker.java:157)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.performCachePut(CacheAspectSupport.java:1087)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.apply(CacheAspectSupport.java:1072)
	at org.springframework.cache.interceptor.CacheAspectSupport.evaluate(CacheAspectSupport.java:616)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:448)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:410)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:65)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at com.example.demo.service.ChatMessageService$$SpringCGLIB$$0.getRecentMessages(<generated>)
	at com.example.demo.controller.ChatRoomController.getMessages(ChatRoomController.java:169)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to serialize object using DefaultSerializer
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:64)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:33)
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:96)
	... 65 common frames omitted
Caused by: java.io.NotSerializableException: com.example.demo.entity.ChatMessage
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at java.base/java.util.ArrayList.writeObject(ArrayList.java:866)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1074)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1526)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at org.springframework.core.serializer.DefaultSerializer.serialize(DefaultSerializer.java:46)
	at org.springframework.core.serializer.Serializer.serializeToByteArray(Serializer.java:56)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:60)
	... 67 common frames omitted
2025-06-05 11:37:40 [clientInboundChannel-18] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=pws5vy5n, lookupDestination='/chat.sendMessage'
2025-06-05 11:37:40 [clientInboundChannel-18] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 11:37:40 [clientInboundChannel-18] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 252525 from Jared in room 1
2025-06-05 11:37:40 [clientInboundChannel-18] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 11:37:40 [clientInboundChannel-18] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [252525]
2025-06-05 11:37:40 [clientInboundChannel-18] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T11:37:40.390251600]
2025-06-05 11:37:40 [clientInboundChannel-18] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 11:37:40 [clientInboundChannel-18] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 11:37:40 [clientInboundChannel-18] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 11:37:40 [clientInboundChannel-18] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 11:37:40 [clientInboundChannel-18] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 11:37:40 [clientInboundChannel-18] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 11:37:40 [clientInboundChannel-18] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749094660387]
2025-06-05 11:37:40 [clientInboundChannel-18] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 11:37:40 [clientInboundChannel-18] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T11:37:40.390251600]
2025-06-05 11:37:40 [clientInboundChannel-18] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 6
2025-06-05 11:37:48 [clientInboundChannel-19] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=dmhodskb, lookupDestination='/chat.sendMessage'
2025-06-05 11:37:48 [clientInboundChannel-19] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 11:37:48 [clientInboundChannel-19] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 25252525 from Leo in room 1
2025-06-05 11:37:48 [clientInboundChannel-19] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 11:37:48 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [25252525]
2025-06-05 11:37:48 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T11:37:48.916923900]
2025-06-05 11:37:48 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 11:37:48 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 11:37:48 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 11:37:48 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 11:37:48 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 11:37:48 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 11:37:48 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749094668913]
2025-06-05 11:37:48 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 11:37:48 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T11:37:48.916923900]
2025-06-05 11:37:48 [clientInboundChannel-19] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 7
2025-06-05 11:37:54 [http-nio-8015-exec-4] INFO  c.e.d.controller.ChatRoomController - 嘗試建立聊天室: apple by Leo
2025-06-05 11:37:54 [http-nio-8015-exec-4] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id 
    from
        chat_rooms cr1_0 
    where
        cr1_0.name=? 
        and cr1_0.is_active 
    fetch
        first ? rows only
2025-06-05 11:37:54 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [apple]
2025-06-05 11:37:54 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2025-06-05 11:37:54 [http-nio-8015-exec-4] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id 
    from
        chat_rooms cr1_0 
    where
        cr1_0.name=? 
        and cr1_0.is_active 
    fetch
        first ? rows only
2025-06-05 11:37:54 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [apple]
2025-06-05 11:37:54 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2025-06-05 11:37:54 [http-nio-8015-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_rooms
        (created_at, creator, description, is_active, member_count, name, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2025-06-05 11:37:54 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:TIMESTAMP) <- [2025-06-05T11:37:54.332712300]
2025-06-05 11:37:54 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [Leo]
2025-06-05 11:37:54 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 11:37:54 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BOOLEAN) <- [true]
2025-06-05 11:37:54 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:INTEGER) <- [0]
2025-06-05 11:37:54 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [apple]
2025-06-05 11:37:54 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:TIMESTAMP) <- [2025-06-05T11:37:54.332712300]
2025-06-05 11:37:54 [http-nio-8015-exec-4] INFO  c.e.demo.service.ChatRoomService - 成功建立聊天室: apple (ID: 1)
2025-06-05 11:37:54 [http-nio-8015-exec-4] INFO  c.e.d.controller.ChatRoomController - 成功建立聊天室: apple, ID: 1
2025-06-05 11:37:54 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 11:38:06 [http-nio-8015-exec-5] INFO  c.e.d.controller.ChatRoomController - 嘗試建立聊天室: apple by Jared
2025-06-05 11:38:06 [http-nio-8015-exec-5] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id 
    from
        chat_rooms cr1_0 
    where
        cr1_0.name=? 
        and cr1_0.is_active 
    fetch
        first ? rows only
2025-06-05 11:38:06 [http-nio-8015-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [apple]
2025-06-05 11:38:06 [http-nio-8015-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2025-06-05 11:38:06 [MessageBroker-18] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 5 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(5)-CONNECTED(5)-DISCONNECT(3)], stompBrokerRelay[null], inboundChannel[pool size = 48, active threads = 0, queued tasks = 0, completed tasks = 69], outboundChannel[pool size = 25, active threads = 0, queued tasks = 0, completed tasks = 25], sockJsScheduler[pool size = 24, active threads = 1, queued tasks = 3, completed tasks = 12]
2025-06-05 12:08:06 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 5 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(5)-CONNECTED(5)-DISCONNECT(3)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 69], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 25], sockJsScheduler[pool size = 24, active threads = 1, queued tasks = 3, completed tasks = 517]
2025-06-05 12:38:06 [MessageBroker-5] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 5 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(5)-CONNECTED(5)-DISCONNECT(3)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 69], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 25], sockJsScheduler[pool size = 24, active threads = 1, queued tasks = 3, completed tasks = 1022]
2025-06-05 13:08:06 [MessageBroker-23] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 5 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(5)-CONNECTED(5)-DISCONNECT(3)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 69], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 25], sockJsScheduler[pool size = 24, active threads = 1, queued tasks = 3, completed tasks = 1527]
2025-06-05 13:38:06 [MessageBroker-16] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 5 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(5)-CONNECTED(5)-DISCONNECT(3)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 69], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 25], sockJsScheduler[pool size = 24, active threads = 1, queued tasks = 3, completed tasks = 2032]
2025-06-05 14:03:24 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Starting SpringWebsocket3Application using Java 17.0.11 with PID 52980 (D:\WorkSpace\SpringTset\SpringTest\Spring_Websocket3\build\classes\java\main started by Jared in D:\WorkSpace\SpringTset\SpringTest)
2025-06-05 14:03:24 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - No active profile set, falling back to 1 default profile: "default"
2025-06-05 14:03:24 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-06-05 14:03:24 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JDBC repositories in DEFAULT mode.
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 24 ms. Found 0 JDBC repository interfaces.
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 65 ms. Found 2 JPA repository interfaces.
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 14:03:25 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 3 ms. Found 0 Redis repository interfaces.
2025-06-05 14:03:26 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8015 (http)
2025-06-05 14:03:26 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-05 14:03:26 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.41]
2025-06-05 14:03:26 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-05 14:03:26 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1575 ms
2025-06-05 14:03:27 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-05 14:03:27 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.15.Final
2025-06-05 14:03:27 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-05 14:03:27 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-05 14:03:27 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-05 14:03:27 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@44bf3bf9
2025-06-05 14:03:27 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-05 14:03:27 [restartedMain] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-05 14:03:27 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 16.3
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-06-05 14:03:28 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-05 14:03:28 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-05 14:03:28 [restartedMain] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-05 14:03:30 [restartedMain] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-06-05 14:03:30 [restartedMain] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-05 14:03:30 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.ChatRoomController:
	
2025-06-05 14:03:30 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.ChatWebSocketController:
	{[MESSAGE],[/chat.sendMessage]}: sendMessage(ChatMessage)
	{[MESSAGE],[/chat.leaveRoom]}: leaveRoom(ChatMessage)
	{[MESSAGE],[/chat.joinRoom]}: joinRoom(ChatMessage,SimpMessageHeaderAccessor)
2025-06-05 14:03:30 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.FileUploadController:
	
2025-06-05 14:03:30 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.WebController:
	
2025-06-05 14:03:30 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-06-05 14:03:30 [restartedMain] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page template: index
2025-06-05 14:03:30 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-06-05 14:03:30 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-05 14:03:30 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@59005d9c]]
2025-06-05 14:03:30 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-05 14:03:30 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8015 (http) with context path '/'
2025-06-05 14:03:30 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Started SpringWebsocket3Application in 6.476 seconds (process running for 6.852)
2025-06-05 14:03:32 [http-nio-8015-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-05 14:03:32 [http-nio-8015-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-05 14:03:32 [http-nio-8015-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-05 14:03:32 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@3f2b28d4
2025-06-05 14:03:32 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749103412276
2025-06-05 14:03:32 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@3f2b28d4
2025-06-05 14:03:32 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/088/1ys2t4ry/websocket
2025-06-05 14:03:32 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=1ys2t4ry]
2025-06-05 14:03:32 [clientOutboundChannel-1] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 14:03:32 [clientInboundChannel-7] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=1ys2t4ry, lookupDestination='/chat.joinRoom'
2025-06-05 14:03:32 [clientInboundChannel-7] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 14:03:32 [clientInboundChannel-7] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 14:03:32 [clientInboundChannel-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 14:03:32 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 14:03:32 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T14:03:32.600137]
2025-06-05 14:03:32 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 14:03:32 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 14:03:32 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 14:03:32 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 14:03:32 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 14:03:32 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 14:03:32 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749103412559]
2025-06-05 14:03:32 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 14:03:32 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T14:03:32.601138200]
2025-06-05 14:03:32 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 14:03:32 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@3f2b28d4
2025-06-05 14:03:32 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749103412899
2025-06-05 14:03:32 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@3f2b28d4
2025-06-05 14:03:32 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/199/4tmizfif/websocket
2025-06-05 14:03:32 [http-nio-8015-exec-7] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=4tmizfif]
2025-06-05 14:03:32 [clientOutboundChannel-2] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 14:03:32 [clientInboundChannel-16] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=4tmizfif, lookupDestination='/chat.joinRoom'
2025-06-05 14:03:32 [clientInboundChannel-16] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 14:03:32 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 14:03:32 [clientInboundChannel-16] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 14:03:32 [clientInboundChannel-16] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 14:03:32 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 14:03:32 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T14:03:32.951692100]
2025-06-05 14:03:32 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 14:03:32 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 14:03:32 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 14:03:32 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 14:03:32 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 14:03:32 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 14:03:32 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749103412950]
2025-06-05 14:03:32 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 14:03:32 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T14:03:32.952700700]
2025-06-05 14:03:33 [http-nio-8015-exec-5] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.created_at 
    fetch
        first ? rows only
2025-06-05 14:03:33 [http-nio-8015-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 14:03:33 [http-nio-8015-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 14:03:33 [http-nio-8015-exec-5] ERROR c.e.d.controller.ChatRoomController - 获取聊天室消息失败: 1
org.springframework.data.redis.serializer.SerializationException: Cannot serialize
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:98)
	at org.springframework.data.redis.serializer.DefaultRedisElementWriter.write(DefaultRedisElementWriter.java:42)
	at org.springframework.data.redis.serializer.RedisSerializationContext$SerializationPair.write(RedisSerializationContext.java:292)
	at org.springframework.data.redis.cache.RedisCache.serializeCacheValue(RedisCache.java:343)
	at org.springframework.data.redis.cache.RedisCache.put(RedisCache.java:204)
	at org.springframework.cache.interceptor.AbstractCacheInvoker.doPut(AbstractCacheInvoker.java:157)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.performCachePut(CacheAspectSupport.java:1087)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.apply(CacheAspectSupport.java:1072)
	at org.springframework.cache.interceptor.CacheAspectSupport.evaluate(CacheAspectSupport.java:616)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:448)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:410)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:65)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at com.example.demo.service.ChatMessageService$$SpringCGLIB$$0.getRecentMessages(<generated>)
	at com.example.demo.controller.ChatRoomController.getMessages(ChatRoomController.java:169)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to serialize object using DefaultSerializer
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:64)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:33)
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:96)
	... 65 common frames omitted
Caused by: java.io.NotSerializableException: com.example.demo.entity.ChatMessage
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at java.base/java.util.ArrayList.writeObject(ArrayList.java:866)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1074)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1526)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at org.springframework.core.serializer.DefaultSerializer.serialize(DefaultSerializer.java:46)
	at org.springframework.core.serializer.Serializer.serializeToByteArray(Serializer.java:56)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:60)
	... 67 common frames omitted
2025-06-05 14:03:33 [http-nio-8015-exec-1] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.created_at 
    fetch
        first ? rows only
2025-06-05 14:03:33 [http-nio-8015-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 14:03:33 [http-nio-8015-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 14:03:33 [http-nio-8015-exec-1] ERROR c.e.d.controller.ChatRoomController - 获取聊天室消息失败: 1
org.springframework.data.redis.serializer.SerializationException: Cannot serialize
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:98)
	at org.springframework.data.redis.serializer.DefaultRedisElementWriter.write(DefaultRedisElementWriter.java:42)
	at org.springframework.data.redis.serializer.RedisSerializationContext$SerializationPair.write(RedisSerializationContext.java:292)
	at org.springframework.data.redis.cache.RedisCache.serializeCacheValue(RedisCache.java:343)
	at org.springframework.data.redis.cache.RedisCache.put(RedisCache.java:204)
	at org.springframework.cache.interceptor.AbstractCacheInvoker.doPut(AbstractCacheInvoker.java:157)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.performCachePut(CacheAspectSupport.java:1087)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.apply(CacheAspectSupport.java:1072)
	at org.springframework.cache.interceptor.CacheAspectSupport.evaluate(CacheAspectSupport.java:616)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:448)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:410)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:65)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at com.example.demo.service.ChatMessageService$$SpringCGLIB$$0.getRecentMessages(<generated>)
	at com.example.demo.controller.ChatRoomController.getMessages(ChatRoomController.java:169)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to serialize object using DefaultSerializer
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:64)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:33)
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:96)
	... 65 common frames omitted
Caused by: java.io.NotSerializableException: com.example.demo.entity.ChatMessage
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at java.base/java.util.ArrayList.writeObject(ArrayList.java:866)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1074)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1526)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at org.springframework.core.serializer.DefaultSerializer.serialize(DefaultSerializer.java:46)
	at org.springframework.core.serializer.Serializer.serializeToByteArray(Serializer.java:56)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:60)
	... 67 common frames omitted
2025-06-05 14:03:43 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=1ys2t4ry] closed with CloseStatus[code=1000, reason=null]
2025-06-05 14:03:43 [http-nio-8015-exec-3] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session 1ys2t4ry
2025-06-05 14:03:43 [http-nio-8015-exec-3] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 14:03:43 [clientOutboundChannel-7] DEBUG o.s.w.s.m.StompSubProtocolHandler - Failed to send WebSocket message to client in session 1ys2t4ry
java.lang.IllegalStateException: Cannot send a message when session is closed
	at org.springframework.util.Assert.state(Assert.java:79)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.sendMessage(AbstractSockJsSession.java:144)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.tryFlushMessageBuffer(ConcurrentWebSocketSessionDecorator.java:190)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.sendMessage(ConcurrentWebSocketSessionDecorator.java:163)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.sendToClient(StompSubProtocolHandler.java:529)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.handleMessageToClient(StompSubProtocolHandler.java:516)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.handleMessage(SubProtocolWebSocketHandler.java:387)
	at org.springframework.messaging.support.ExecutorSubscribableChannel$SendTask.run(ExecutorSubscribableChannel.java:152)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-06-05 14:03:43 [clientOutboundChannel-8] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=1ys2t4ry}], simpSessionId=1ys2t4ry}]
2025-06-05 14:03:46 [http-nio-8015-exec-6] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=4tmizfif] closed with CloseStatus[code=1000, reason=null]
2025-06-05 14:03:46 [http-nio-8015-exec-6] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session 4tmizfif
2025-06-05 14:03:46 [http-nio-8015-exec-6] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 14:03:46 [clientOutboundChannel-9] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@795a23bb, simpSessionId=4tmizfif}], simpSessionId=4tmizfif}]
2025-06-05 14:03:46 [clientOutboundChannel-10] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=4tmizfif}], simpSessionId=4tmizfif}]
2025-06-05 14:03:52 [MessageBroker-7] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 2 sessions: [1ys2t4ry, 4tmizfif]
2025-06-05 14:04:30 [MessageBroker-5] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 2 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(2)-CONNECTED(2)-DISCONNECT(2)], stompBrokerRelay[null], inboundChannel[pool size = 30, active threads = 0, queued tasks = 0, completed tasks = 30], outboundChannel[pool size = 10, active threads = 0, queued tasks = 0, completed tasks = 10], sockJsScheduler[pool size = 22, active threads = 1, queued tasks = 1, completed tasks = 12]
2025-06-05 14:04:50 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Starting SpringWebsocket3Application using Java 17.0.11 with PID 47932 (D:\WorkSpace\SpringTset\SpringTest\Spring_Websocket3\build\classes\java\main started by Jared in D:\WorkSpace\SpringTset\SpringTest)
2025-06-05 14:04:50 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - No active profile set, falling back to 1 default profile: "default"
2025-06-05 14:04:50 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-06-05 14:04:50 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JDBC repositories in DEFAULT mode.
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 32 ms. Found 0 JDBC repository interfaces.
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 64 ms. Found 2 JPA repository interfaces.
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 14:04:51 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 3 ms. Found 0 Redis repository interfaces.
2025-06-05 14:04:52 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8015 (http)
2025-06-05 14:04:52 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-05 14:04:52 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.41]
2025-06-05 14:04:52 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-05 14:04:52 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1618 ms
2025-06-05 14:04:53 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-05 14:04:53 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.15.Final
2025-06-05 14:04:53 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-05 14:04:53 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-05 14:04:53 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-05 14:04:53 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@27c76926
2025-06-05 14:04:53 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-05 14:04:53 [restartedMain] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-05 14:04:53 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 16.3
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-06-05 14:04:54 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-05 14:04:54 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-05 14:04:54 [restartedMain] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-05 14:04:56 [restartedMain] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-06-05 14:04:56 [restartedMain] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-05 14:04:56 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.ChatRoomController:
	
2025-06-05 14:04:56 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.ChatWebSocketController:
	{[MESSAGE],[/chat.sendMessage]}: sendMessage(ChatMessage)
	{[MESSAGE],[/chat.joinRoom]}: joinRoom(ChatMessage,SimpMessageHeaderAccessor)
	{[MESSAGE],[/chat.leaveRoom]}: leaveRoom(ChatMessage)
2025-06-05 14:04:56 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.FileUploadController:
	
2025-06-05 14:04:56 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.WebController:
	
2025-06-05 14:04:56 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-06-05 14:04:56 [restartedMain] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page template: index
2025-06-05 14:04:56 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-06-05 14:04:56 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-05 14:04:56 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@25eb0381]]
2025-06-05 14:04:56 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-05 14:04:56 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8015 (http) with context path '/'
2025-06-05 14:04:56 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Started SpringWebsocket3Application in 6.922 seconds (process running for 7.268)
2025-06-05 14:05:18 [http-nio-8015-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-05 14:05:18 [http-nio-8015-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-05 14:05:18 [http-nio-8015-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 0 ms
2025-06-05 14:05:18 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@5bf4b1c2
2025-06-05 14:05:18 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749103518525
2025-06-05 14:05:18 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@5bf4b1c2
2025-06-05 14:05:18 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/332/izzyfkk4/websocket
2025-06-05 14:05:18 [http-nio-8015-exec-4] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=izzyfkk4]
2025-06-05 14:05:18 [clientOutboundChannel-1] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 14:05:18 [clientInboundChannel-7] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=izzyfkk4, lookupDestination='/chat.joinRoom'
2025-06-05 14:05:18 [clientInboundChannel-7] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 14:05:18 [clientInboundChannel-7] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 14:05:18 [clientInboundChannel-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 14:05:18 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 14:05:18 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 14:05:18 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T14:05:18.777432600]
2025-06-05 14:05:18 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 14:05:18 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 14:05:18 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 14:05:18 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 14:05:18 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 14:05:18 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 14:05:18 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749103518753]
2025-06-05 14:05:18 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 14:05:18 [clientInboundChannel-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T14:05:18.777432600]
2025-06-05 14:05:19 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.created_at 
    fetch
        first ? rows only
2025-06-05 14:05:19 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 14:05:19 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 14:05:19 [http-nio-8015-exec-8] ERROR c.e.d.controller.ChatRoomController - 获取聊天室消息失败: 1
org.springframework.data.redis.serializer.SerializationException: Cannot serialize
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:98)
	at org.springframework.data.redis.serializer.DefaultRedisElementWriter.write(DefaultRedisElementWriter.java:42)
	at org.springframework.data.redis.serializer.RedisSerializationContext$SerializationPair.write(RedisSerializationContext.java:292)
	at org.springframework.data.redis.cache.RedisCache.serializeCacheValue(RedisCache.java:343)
	at org.springframework.data.redis.cache.RedisCache.put(RedisCache.java:204)
	at org.springframework.cache.interceptor.AbstractCacheInvoker.doPut(AbstractCacheInvoker.java:157)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.performCachePut(CacheAspectSupport.java:1087)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.apply(CacheAspectSupport.java:1072)
	at org.springframework.cache.interceptor.CacheAspectSupport.evaluate(CacheAspectSupport.java:616)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:448)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:410)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:65)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at com.example.demo.service.ChatMessageService$$SpringCGLIB$$0.getRecentMessages(<generated>)
	at com.example.demo.controller.ChatRoomController.getMessages(ChatRoomController.java:169)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to serialize object using DefaultSerializer
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:64)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:33)
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:96)
	... 65 common frames omitted
Caused by: java.io.NotSerializableException: com.example.demo.entity.ChatMessage
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at java.base/java.util.ArrayList.writeObject(ArrayList.java:866)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1074)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1526)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at org.springframework.core.serializer.DefaultSerializer.serialize(DefaultSerializer.java:46)
	at org.springframework.core.serializer.Serializer.serializeToByteArray(Serializer.java:56)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:60)
	... 67 common frames omitted
2025-06-05 14:05:21 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@5bf4b1c2
2025-06-05 14:05:21 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749103521207
2025-06-05 14:05:21 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@5bf4b1c2
2025-06-05 14:05:21 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/515/eawpa4op/websocket
2025-06-05 14:05:21 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=eawpa4op]
2025-06-05 14:05:21 [clientOutboundChannel-3] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 14:05:21 [http-nio-8015-exec-5] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 14:05:21 [clientInboundChannel-16] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=eawpa4op, lookupDestination='/chat.joinRoom'
2025-06-05 14:05:21 [clientInboundChannel-16] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 14:05:21 [clientInboundChannel-16] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 14:05:21 [clientInboundChannel-16] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 14:05:21 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 14:05:21 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T14:05:21.329899200]
2025-06-05 14:05:21 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 14:05:21 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 14:05:21 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 14:05:21 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 14:05:21 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 14:05:21 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 14:05:21 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749103521327]
2025-06-05 14:05:21 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.created_at 
    fetch
        first ? rows only
2025-06-05 14:05:21 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 14:05:21 [clientInboundChannel-16] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T14:05:21.329899200]
2025-06-05 14:05:21 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 14:05:21 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 14:05:21 [http-nio-8015-exec-6] ERROR c.e.d.controller.ChatRoomController - 获取聊天室消息失败: 1
org.springframework.data.redis.serializer.SerializationException: Cannot serialize
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:98)
	at org.springframework.data.redis.serializer.DefaultRedisElementWriter.write(DefaultRedisElementWriter.java:42)
	at org.springframework.data.redis.serializer.RedisSerializationContext$SerializationPair.write(RedisSerializationContext.java:292)
	at org.springframework.data.redis.cache.RedisCache.serializeCacheValue(RedisCache.java:343)
	at org.springframework.data.redis.cache.RedisCache.put(RedisCache.java:204)
	at org.springframework.cache.interceptor.AbstractCacheInvoker.doPut(AbstractCacheInvoker.java:157)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.performCachePut(CacheAspectSupport.java:1087)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.apply(CacheAspectSupport.java:1072)
	at org.springframework.cache.interceptor.CacheAspectSupport.evaluate(CacheAspectSupport.java:616)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:448)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:410)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:65)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at com.example.demo.service.ChatMessageService$$SpringCGLIB$$0.getRecentMessages(<generated>)
	at com.example.demo.controller.ChatRoomController.getMessages(ChatRoomController.java:169)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to serialize object using DefaultSerializer
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:64)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:33)
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:96)
	... 65 common frames omitted
Caused by: java.io.NotSerializableException: com.example.demo.entity.ChatMessage
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at java.base/java.util.ArrayList.writeObject(ArrayList.java:866)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1074)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1526)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at org.springframework.core.serializer.DefaultSerializer.serialize(DefaultSerializer.java:46)
	at org.springframework.core.serializer.Serializer.serializeToByteArray(Serializer.java:56)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:60)
	... 67 common frames omitted
2025-06-05 14:05:26 [http-nio-8015-exec-7] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=eawpa4op] closed with CloseStatus[code=1000, reason=null]
2025-06-05 14:05:26 [http-nio-8015-exec-7] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session eawpa4op
2025-06-05 14:05:26 [clientOutboundChannel-6] DEBUG o.s.w.s.m.StompSubProtocolHandler - Failed to send WebSocket message to client in session eawpa4op
java.lang.IllegalStateException: Cannot send a message when session is closed
	at org.springframework.util.Assert.state(Assert.java:79)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.sendMessage(AbstractSockJsSession.java:144)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.tryFlushMessageBuffer(ConcurrentWebSocketSessionDecorator.java:190)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.sendMessage(ConcurrentWebSocketSessionDecorator.java:163)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.sendToClient(StompSubProtocolHandler.java:529)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.handleMessageToClient(StompSubProtocolHandler.java:516)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.handleMessage(SubProtocolWebSocketHandler.java:387)
	at org.springframework.messaging.support.ExecutorSubscribableChannel$SendTask.run(ExecutorSubscribableChannel.java:152)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-06-05 14:05:26 [http-nio-8015-exec-7] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 14:05:26 [clientOutboundChannel-7] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=eawpa4op}], simpSessionId=eawpa4op}]
2025-06-05 14:05:33 [MessageBroker-5] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [eawpa4op]
2025-06-05 14:05:35 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@5bf4b1c2
2025-06-05 14:05:35 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749103535426
2025-06-05 14:05:35 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@5bf4b1c2
2025-06-05 14:05:35 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/001/xvmi233u/websocket
2025-06-05 14:05:35 [http-nio-8015-exec-2] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=xvmi233u]
2025-06-05 14:05:35 [clientOutboundChannel-8] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 14:05:35 [clientInboundChannel-31] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=xvmi233u, lookupDestination='/chat.joinRoom'
2025-06-05 14:05:35 [clientInboundChannel-31] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 14:05:35 [clientInboundChannel-31] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 14:05:35 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 14:05:35 [clientInboundChannel-31] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 14:05:35 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 14:05:35 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T14:05:35.510489900]
2025-06-05 14:05:35 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 14:05:35 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 14:05:35 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 14:05:35 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 14:05:35 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 14:05:35 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 14:05:35 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749103535507]
2025-06-05 14:05:35 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 14:05:35 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T14:05:35.510489900]
2025-06-05 14:05:35 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.created_at 
    fetch
        first ? rows only
2025-06-05 14:05:35 [http-nio-8015-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 14:05:35 [http-nio-8015-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 14:05:35 [http-nio-8015-exec-7] ERROR c.e.d.controller.ChatRoomController - 获取聊天室消息失败: 1
org.springframework.data.redis.serializer.SerializationException: Cannot serialize
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:98)
	at org.springframework.data.redis.serializer.DefaultRedisElementWriter.write(DefaultRedisElementWriter.java:42)
	at org.springframework.data.redis.serializer.RedisSerializationContext$SerializationPair.write(RedisSerializationContext.java:292)
	at org.springframework.data.redis.cache.RedisCache.serializeCacheValue(RedisCache.java:343)
	at org.springframework.data.redis.cache.RedisCache.put(RedisCache.java:204)
	at org.springframework.cache.interceptor.AbstractCacheInvoker.doPut(AbstractCacheInvoker.java:157)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.performCachePut(CacheAspectSupport.java:1087)
	at org.springframework.cache.interceptor.CacheAspectSupport$CachePutRequest.apply(CacheAspectSupport.java:1072)
	at org.springframework.cache.interceptor.CacheAspectSupport.evaluate(CacheAspectSupport.java:616)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:448)
	at org.springframework.cache.interceptor.CacheAspectSupport.execute(CacheAspectSupport.java:410)
	at org.springframework.cache.interceptor.CacheInterceptor.invoke(CacheInterceptor.java:65)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at com.example.demo.service.ChatMessageService$$SpringCGLIB$$0.getRecentMessages(<generated>)
	at com.example.demo.controller.ChatRoomController.getMessages(ChatRoomController.java:169)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed to serialize object using DefaultSerializer
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:64)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:33)
	at org.springframework.data.redis.serializer.JdkSerializationRedisSerializer.serialize(JdkSerializationRedisSerializer.java:96)
	... 65 common frames omitted
Caused by: java.io.NotSerializableException: com.example.demo.entity.ChatMessage
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1197)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at java.base/java.util.ArrayList.writeObject(ArrayList.java:866)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1074)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1526)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1582)
	at java.base/java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1539)
	at java.base/java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1448)
	at java.base/java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1191)
	at java.base/java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:354)
	at org.springframework.core.serializer.DefaultSerializer.serialize(DefaultSerializer.java:46)
	at org.springframework.core.serializer.Serializer.serializeToByteArray(Serializer.java:56)
	at org.springframework.core.serializer.support.SerializingConverter.convert(SerializingConverter.java:60)
	... 67 common frames omitted
2025-06-05 14:05:42 [clientInboundChannel-34] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=izzyfkk4, lookupDestination='/chat.sendMessage'
2025-06-05 14:05:42 [clientInboundChannel-34] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 14:05:42 [clientInboundChannel-34] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 252525 from Jared in room 1
2025-06-05 14:05:42 [clientInboundChannel-34] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 14:05:42 [clientInboundChannel-34] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [252525]
2025-06-05 14:05:42 [clientInboundChannel-34] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T14:05:42.882429400]
2025-06-05 14:05:42 [clientInboundChannel-34] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 14:05:42 [clientInboundChannel-34] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 14:05:42 [clientInboundChannel-34] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 14:05:42 [clientInboundChannel-34] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 14:05:42 [clientInboundChannel-34] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 14:05:42 [clientInboundChannel-34] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 14:05:42 [clientInboundChannel-34] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749103542877]
2025-06-05 14:05:42 [clientInboundChannel-34] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 14:05:42 [clientInboundChannel-34] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T14:05:42.882429400]
2025-06-05 14:05:42 [clientInboundChannel-34] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 13
2025-06-05 14:05:49 [clientInboundChannel-37] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=xvmi233u, lookupDestination='/chat.sendMessage'
2025-06-05 14:05:49 [clientInboundChannel-37] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 14:05:49 [clientInboundChannel-37] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 252525252525252 from Leo in room 1
2025-06-05 14:05:49 [clientInboundChannel-37] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 14:05:49 [clientInboundChannel-37] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [252525252525252]
2025-06-05 14:05:49 [clientInboundChannel-37] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T14:05:49.065039600]
2025-06-05 14:05:49 [clientInboundChannel-37] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 14:05:49 [clientInboundChannel-37] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 14:05:49 [clientInboundChannel-37] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 14:05:49 [clientInboundChannel-37] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 14:05:49 [clientInboundChannel-37] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 14:05:49 [clientInboundChannel-37] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 14:05:49 [clientInboundChannel-37] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749103549060]
2025-06-05 14:05:49 [clientInboundChannel-37] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 14:05:49 [clientInboundChannel-37] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T14:05:49.065039600]
2025-06-05 14:05:49 [clientInboundChannel-37] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 14
2025-06-05 14:05:56 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 3 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(3)-CONNECTED(3)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 39, active threads = 0, queued tasks = 0, completed tasks = 39], outboundChannel[pool size = 14, active threads = 0, queued tasks = 0, completed tasks = 14], sockJsScheduler[pool size = 24, active threads = 1, queued tasks = 3, completed tasks = 8]
2025-06-05 14:35:56 [MessageBroker-16] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 3 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(3)-CONNECTED(3)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 39], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 14], sockJsScheduler[pool size = 24, active threads = 1, queued tasks = 3, completed tasks = 513]
2025-06-05 15:01:39 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Starting SpringWebsocket3Application using Java 17.0.11 with PID 46464 (D:\WorkSpace\SpringTset\SpringTest\Spring_Websocket3\build\classes\java\main started by Jared in D:\WorkSpace\SpringTset\SpringTest)
2025-06-05 15:01:39 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - No active profile set, falling back to 1 default profile: "default"
2025-06-05 15:01:39 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-06-05 15:01:39 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JDBC repositories in DEFAULT mode.
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 24 ms. Found 0 JDBC repository interfaces.
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 64 ms. Found 2 JPA repository interfaces.
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 15:01:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 2 ms. Found 0 Redis repository interfaces.
2025-06-05 15:01:41 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8015 (http)
2025-06-05 15:01:41 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-05 15:01:41 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.41]
2025-06-05 15:01:41 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-05 15:01:41 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1488 ms
2025-06-05 15:01:41 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-05 15:01:41 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.15.Final
2025-06-05 15:01:41 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-05 15:01:42 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-05 15:01:42 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-05 15:01:42 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@4c33fd3b
2025-06-05 15:01:42 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-05 15:01:42 [restartedMain] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-05 15:01:42 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 16.3
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-06-05 15:01:43 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-05 15:01:43 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-05 15:01:43 [restartedMain] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-05 15:01:44 [restartedMain] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-06-05 15:01:44 [restartedMain] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-05 15:01:44 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.ChatRoomController:
	
2025-06-05 15:01:44 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.ChatWebSocketController:
	{[MESSAGE],[/chat.joinRoom]}: joinRoom(ChatMessage,SimpMessageHeaderAccessor)
	{[MESSAGE],[/chat.leaveRoom]}: leaveRoom(ChatMessage)
	{[MESSAGE],[/chat.sendMessage]}: sendMessage(ChatMessage)
2025-06-05 15:01:44 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.FileUploadController:
	
2025-06-05 15:01:44 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.WebController:
	
2025-06-05 15:01:44 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-06-05 15:01:44 [restartedMain] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page template: index
2025-06-05 15:01:45 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-06-05 15:01:45 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-05 15:01:45 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@6bafb8dc]]
2025-06-05 15:01:45 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-05 15:01:45 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8015 (http) with context path '/'
2025-06-05 15:01:45 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Started SpringWebsocket3Application in 6.166 seconds (process running for 6.574)
2025-06-05 15:01:45 [http-nio-8015-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-05 15:01:45 [http-nio-8015-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-05 15:01:45 [http-nio-8015-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 0 ms
2025-06-05 15:01:45 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:01:45 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749106905895
2025-06-05 15:01:45 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:01:45 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749106905895
2025-06-05 15:01:45 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:01:46 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/383/oxghgjhl/websocket
2025-06-05 15:01:46 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=oxghgjhl]
2025-06-05 15:01:46 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:01:46 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/026/twfzzrm3/websocket
2025-06-05 15:01:46 [http-nio-8015-exec-4] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=twfzzrm3]
2025-06-05 15:01:46 [clientOutboundChannel-1] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:01:46 [clientOutboundChannel-2] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:01:46 [clientInboundChannel-13] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=oxghgjhl, lookupDestination='/chat.joinRoom'
2025-06-05 15:01:46 [clientInboundChannel-14] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=twfzzrm3, lookupDestination='/chat.joinRoom'
2025-06-05 15:01:46 [clientInboundChannel-14] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:01:46 [clientInboundChannel-13] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:01:46 [http-nio-8015-exec-9] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:01:46 [clientInboundChannel-13] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 15:01:46 [clientInboundChannel-14] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 15:01:46 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:01:46 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:01:46 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:01:46 [http-nio-8015-exec-9] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:01:46 [clientInboundChannel-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:01:46 [clientInboundChannel-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:01:46 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 15:01:46 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 15:01:46 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:01:46.166853100]
2025-06-05 15:01:46 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:01:46.166853100]
2025-06-05 15:01:46 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:01:46 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:01:46 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:01:46 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:01:46 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:01:46 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:01:46 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:01:46 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:01:46 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:01:46 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749106906156]
2025-06-05 15:01:46 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:01:46 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:01:46 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:01:46 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:01:46.166853100]
2025-06-05 15:01:46 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:01:46 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749106906156]
2025-06-05 15:01:46 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:01:46 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:01:46.166853100]
2025-06-05 15:01:46 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:01:46 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:01:46 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:01:46 [http-nio-8015-exec-9] INFO  c.e.demo.service.ChatMessageService - 成功獲取 14 條消息
2025-06-05 15:01:46 [http-nio-8015-exec-10] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:01:46 [http-nio-8015-exec-9] INFO  c.e.d.controller.ChatRoomController - 成功獲取 14 條消息
2025-06-05 15:01:46 [http-nio-8015-exec-1] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:01:46 [http-nio-8015-exec-1] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:01:46 [http-nio-8015-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:01:46 [http-nio-8015-exec-1] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:01:46 [http-nio-8015-exec-1] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:01:46 [http-nio-8015-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:01:46 [http-nio-8015-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:01:46 [http-nio-8015-exec-1] INFO  c.e.demo.service.ChatMessageService - 成功獲取 16 條消息
2025-06-05 15:01:46 [http-nio-8015-exec-1] INFO  c.e.d.controller.ChatRoomController - 成功獲取 16 條消息
2025-06-05 15:02:04 [clientInboundChannel-19] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=twfzzrm3, lookupDestination='/chat.sendMessage'
2025-06-05 15:02:04 [clientInboundChannel-19] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 15:02:04 [clientInboundChannel-19] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 02020202020 from Leo in room 1
2025-06-05 15:02:04 [clientInboundChannel-19] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:02:04 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [02020202020]
2025-06-05 15:02:04 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:02:04.974690300]
2025-06-05 15:02:04 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:02:04 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:02:04 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:02:04 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:02:04 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:02:04 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:02:04 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749106924970]
2025-06-05 15:02:04 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 15:02:04 [clientInboundChannel-19] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:02:04.974690300]
2025-06-05 15:02:04 [clientInboundChannel-19] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 17
2025-06-05 15:02:13 [clientInboundChannel-22] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=oxghgjhl, lookupDestination='/chat.sendMessage'
2025-06-05 15:02:13 [clientInboundChannel-22] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 15:02:13 [clientInboundChannel-22] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 2020202020 from Jared in room 1
2025-06-05 15:02:13 [clientInboundChannel-22] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:02:13 [clientInboundChannel-22] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [2020202020]
2025-06-05 15:02:13 [clientInboundChannel-22] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:02:13.019713200]
2025-06-05 15:02:13 [clientInboundChannel-22] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:02:13 [clientInboundChannel-22] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:02:13 [clientInboundChannel-22] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:02:13 [clientInboundChannel-22] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:02:13 [clientInboundChannel-22] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:02:13 [clientInboundChannel-22] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:02:13 [clientInboundChannel-22] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749106933015]
2025-06-05 15:02:13 [clientInboundChannel-22] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 15:02:13 [clientInboundChannel-22] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:02:13.019713200]
2025-06-05 15:02:13 [clientInboundChannel-22] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 18
2025-06-05 15:02:19 [http-nio-8015-exec-7] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=oxghgjhl] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:02:19 [http-nio-8015-exec-7] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session oxghgjhl
2025-06-05 15:02:19 [http-nio-8015-exec-7] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 15:02:19 [clientOutboundChannel-11] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@a774083, simpSessionId=oxghgjhl}], simpSessionId=oxghgjhl}]
2025-06-05 15:02:19 [clientOutboundChannel-12] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=oxghgjhl}], simpSessionId=oxghgjhl}]
2025-06-05 15:02:23 [http-nio-8015-exec-9] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=twfzzrm3] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:02:23 [http-nio-8015-exec-9] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session twfzzrm3
2025-06-05 15:02:23 [http-nio-8015-exec-9] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 15:02:23 [clientOutboundChannel-13] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@4c8c2226, simpSessionId=twfzzrm3}], simpSessionId=twfzzrm3}]
2025-06-05 15:02:23 [clientOutboundChannel-14] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=twfzzrm3}], simpSessionId=twfzzrm3}]
2025-06-05 15:02:26 [MessageBroker-13] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [oxghgjhl]
2025-06-05 15:02:31 [MessageBroker-14] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [twfzzrm3]
2025-06-05 15:02:35 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:02:35 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749106955912
2025-06-05 15:02:35 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:02:35 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/371/k2hxwn3w/websocket
2025-06-05 15:02:35 [http-nio-8015-exec-6] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=k2hxwn3w]
2025-06-05 15:02:36 [clientOutboundChannel-15] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:02:36 [http-nio-8015-exec-9] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:02:36 [clientInboundChannel-43] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=k2hxwn3w, lookupDestination='/chat.joinRoom'
2025-06-05 15:02:36 [http-nio-8015-exec-10] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:02:36 [clientInboundChannel-43] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:02:36 [clientInboundChannel-43] INFO  c.e.d.c.ChatWebSocketController - 用戶 Peter 加入房間 1
2025-06-05 15:02:36 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:02:36 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:02:36 [clientInboundChannel-43] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:02:36 [clientInboundChannel-43] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Peter 加入了聊天室]
2025-06-05 15:02:36 [clientInboundChannel-43] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:02:36.035364300]
2025-06-05 15:02:36 [clientInboundChannel-43] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:02:36 [clientInboundChannel-43] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:02:36 [clientInboundChannel-43] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:02:36 [clientInboundChannel-43] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:02:36 [clientInboundChannel-43] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:02:36 [clientInboundChannel-43] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Peter]
2025-06-05 15:02:36 [clientInboundChannel-43] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749106956032]
2025-06-05 15:02:36 [clientInboundChannel-43] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:02:36 [clientInboundChannel-43] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:02:36.035364300]
2025-06-05 15:02:36 [http-nio-8015-exec-9] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:02:36 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:02:36 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:02:36 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:02:36 [http-nio-8015-exec-9] INFO  c.e.demo.service.ChatMessageService - 成功獲取 18 條消息
2025-06-05 15:02:36 [http-nio-8015-exec-9] INFO  c.e.d.controller.ChatRoomController - 成功獲取 18 條消息
2025-06-05 15:02:45 [MessageBroker-5] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 3 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(3)-CONNECTED(3)-DISCONNECT(2)], stompBrokerRelay[null], inboundChannel[pool size = 45, active threads = 0, queued tasks = 0, completed tasks = 45], outboundChannel[pool size = 16, active threads = 0, queued tasks = 0, completed tasks = 16], sockJsScheduler[pool size = 24, active threads = 1, queued tasks = 2, completed tasks = 12]
2025-06-05 15:02:47 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:02:47 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749106967678
2025-06-05 15:02:47 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:02:47 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/471/4kstdfzt/websocket
2025-06-05 15:02:47 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=4kstdfzt]
2025-06-05 15:02:47 [clientOutboundChannel-17] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:02:47 [http-nio-8015-exec-8] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:02:47 [clientInboundChannel-52] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=4kstdfzt, lookupDestination='/chat.joinRoom'
2025-06-05 15:02:47 [clientInboundChannel-52] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:02:47 [clientInboundChannel-52] INFO  c.e.d.c.ChatWebSocketController - 用戶 Yaaaa 加入房間 1
2025-06-05 15:02:47 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:02:47 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:02:47 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:02:47 [clientInboundChannel-52] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:02:47 [clientInboundChannel-52] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Yaaaa 加入了聊天室]
2025-06-05 15:02:47 [clientInboundChannel-52] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:02:47.793858700]
2025-06-05 15:02:47 [clientInboundChannel-52] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:02:47 [clientInboundChannel-52] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:02:47 [clientInboundChannel-52] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:02:47 [clientInboundChannel-52] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:02:47 [clientInboundChannel-52] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:02:47 [clientInboundChannel-52] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Yaaaa]
2025-06-05 15:02:47 [clientInboundChannel-52] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749106967791]
2025-06-05 15:02:47 [clientInboundChannel-52] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:02:47 [clientInboundChannel-52] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:02:47.793858700]
2025-06-05 15:02:47 [http-nio-8015-exec-8] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:02:47 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:02:47 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:02:47 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:02:47 [http-nio-8015-exec-8] INFO  c.e.demo.service.ChatMessageService - 成功獲取 20 條消息
2025-06-05 15:02:47 [http-nio-8015-exec-8] INFO  c.e.d.controller.ChatRoomController - 成功獲取 20 條消息
2025-06-05 15:02:58 [http-nio-8015-exec-10] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=k2hxwn3w] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:02:58 [http-nio-8015-exec-10] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session k2hxwn3w
2025-06-05 15:02:58 [http-nio-8015-exec-10] INFO  c.e.demo.config.WebSocketConfig - User Peter disconnected from room 1
2025-06-05 15:02:58 [clientOutboundChannel-20] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Peter}, simpHeartbeat=[J@336ac12d, simpSessionId=k2hxwn3w}], simpSessionId=k2hxwn3w}]
2025-06-05 15:02:58 [clientOutboundChannel-21] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Peter}, simpSessionId=k2hxwn3w}], simpSessionId=k2hxwn3w}]
2025-06-05 15:03:05 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:05 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749106985500
2025-06-05 15:03:05 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:05 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/717/2po0gpv0/websocket
2025-06-05 15:03:05 [http-nio-8015-exec-5] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=2po0gpv0]
2025-06-05 15:03:05 [clientOutboundChannel-22] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:03:05 [clientInboundChannel-67] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=2po0gpv0, lookupDestination='/chat.joinRoom'
2025-06-05 15:03:05 [clientInboundChannel-67] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:03:05 [clientInboundChannel-67] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 15:03:05 [clientInboundChannel-67] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:03:05 [clientInboundChannel-67] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 15:03:05 [clientInboundChannel-67] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:03:05.602688500]
2025-06-05 15:03:05 [clientInboundChannel-67] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:03:05 [clientInboundChannel-67] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:03:05 [clientInboundChannel-67] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:03:05 [clientInboundChannel-67] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:03:05 [clientInboundChannel-67] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:03:05 [clientInboundChannel-67] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:03:05 [clientInboundChannel-67] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749106985600]
2025-06-05 15:03:05 [clientInboundChannel-67] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:03:05 [clientInboundChannel-67] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:03:05.602688500]
2025-06-05 15:03:05 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:03:05 [http-nio-8015-exec-9] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:03:05 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:03:05 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:03:05 [http-nio-8015-exec-9] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:03:05 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:03:05 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:03:05 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:03:05 [http-nio-8015-exec-9] INFO  c.e.demo.service.ChatMessageService - 成功獲取 21 條消息
2025-06-05 15:03:05 [http-nio-8015-exec-9] INFO  c.e.d.controller.ChatRoomController - 成功獲取 21 條消息
2025-06-05 15:03:06 [MessageBroker-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [k2hxwn3w]
2025-06-05 15:03:12 [clientInboundChannel-23] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=2po0gpv0, lookupDestination='/chat.sendMessage'
2025-06-05 15:03:12 [clientInboundChannel-23] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 15:03:12 [clientInboundChannel-23] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 2020202 from Leo in room 1
2025-06-05 15:03:12 [clientInboundChannel-23] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:03:12 [clientInboundChannel-23] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [2020202]
2025-06-05 15:03:12 [clientInboundChannel-23] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:03:12.772163100]
2025-06-05 15:03:12 [clientInboundChannel-23] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:03:12 [clientInboundChannel-23] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:03:12 [clientInboundChannel-23] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:03:12 [clientInboundChannel-23] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:03:12 [clientInboundChannel-23] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:03:12 [clientInboundChannel-23] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:03:12 [clientInboundChannel-23] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749106992767]
2025-06-05 15:03:12 [clientInboundChannel-23] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 15:03:12 [clientInboundChannel-23] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:03:12.772163100]
2025-06-05 15:03:12 [clientInboundChannel-23] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 22
2025-06-05 15:03:16 [http-nio-8015-exec-1] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=4kstdfzt] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:03:16 [http-nio-8015-exec-1] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session 4kstdfzt
2025-06-05 15:03:16 [http-nio-8015-exec-1] INFO  c.e.demo.config.WebSocketConfig - User Yaaaa disconnected from room 1
2025-06-05 15:03:16 [clientOutboundChannel-27] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Yaaaa}, simpHeartbeat=[J@7fe4f1a7, simpSessionId=4kstdfzt}], simpSessionId=4kstdfzt}]
2025-06-05 15:03:16 [clientOutboundChannel-28] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Yaaaa}, simpSessionId=4kstdfzt}], simpSessionId=4kstdfzt}]
2025-06-05 15:03:23 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:23 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107003682
2025-06-05 15:03:23 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:23 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/712/rt14t04x/websocket
2025-06-05 15:03:23 [http-nio-8015-exec-7] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=rt14t04x]
2025-06-05 15:03:23 [clientOutboundChannel-29] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:03:23 [clientInboundChannel-76] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=rt14t04x, lookupDestination='/chat.joinRoom'
2025-06-05 15:03:23 [clientInboundChannel-76] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:03:23 [clientInboundChannel-76] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 15:03:23 [clientInboundChannel-76] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:03:23 [clientInboundChannel-76] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 15:03:23 [clientInboundChannel-76] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:03:23.769258800]
2025-06-05 15:03:23 [clientInboundChannel-76] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:03:23 [clientInboundChannel-76] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:03:23 [clientInboundChannel-76] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:03:23 [clientInboundChannel-76] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:03:23 [clientInboundChannel-76] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:03:23 [clientInboundChannel-76] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:03:23 [clientInboundChannel-76] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107003766]
2025-06-05 15:03:23 [clientInboundChannel-76] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:03:23 [clientInboundChannel-76] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:03:23.769258800]
2025-06-05 15:03:23 [http-nio-8015-exec-10] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:03:23 [http-nio-8015-exec-1] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:03:23 [http-nio-8015-exec-1] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:03:23 [http-nio-8015-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:03:23 [http-nio-8015-exec-1] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:03:23 [http-nio-8015-exec-1] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:03:23 [http-nio-8015-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:03:23 [http-nio-8015-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:03:23 [http-nio-8015-exec-1] INFO  c.e.demo.service.ChatMessageService - 成功獲取 23 條消息
2025-06-05 15:03:23 [http-nio-8015-exec-1] INFO  c.e.d.controller.ChatRoomController - 成功獲取 23 條消息
2025-06-05 15:03:26 [MessageBroker-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [4kstdfzt]
2025-06-05 15:03:33 [clientInboundChannel-39] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=rt14t04x, lookupDestination='/chat.sendMessage'
2025-06-05 15:03:33 [clientInboundChannel-39] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 15:03:33 [clientInboundChannel-39] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 20202020 from Jared in room 1
2025-06-05 15:03:33 [clientInboundChannel-39] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:03:33 [clientInboundChannel-39] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [20202020]
2025-06-05 15:03:33 [clientInboundChannel-39] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:03:33.538654500]
2025-06-05 15:03:33 [clientInboundChannel-39] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:03:33 [clientInboundChannel-39] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:03:33 [clientInboundChannel-39] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:03:33 [clientInboundChannel-39] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:03:33 [clientInboundChannel-39] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:03:33 [clientInboundChannel-39] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:03:33 [clientInboundChannel-39] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107013534]
2025-06-05 15:03:33 [clientInboundChannel-39] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 15:03:33 [clientInboundChannel-39] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:03:33.538654500]
2025-06-05 15:03:33 [clientInboundChannel-39] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 24
2025-06-05 15:03:46 [http-nio-8015-exec-4] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=2po0gpv0] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:03:46 [http-nio-8015-exec-4] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session 2po0gpv0
2025-06-05 15:03:46 [http-nio-8015-exec-4] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 15:03:46 [clientOutboundChannel-34] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@6fa21ef, simpSessionId=2po0gpv0}], simpSessionId=2po0gpv0}]
2025-06-05 15:03:46 [clientOutboundChannel-35] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=2po0gpv0}], simpSessionId=2po0gpv0}]
2025-06-05 15:03:46 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:46 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107026478
2025-06-05 15:03:46 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:46 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/176/0wnvbmji/websocket
2025-06-05 15:03:46 [http-nio-8015-exec-7] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=0wnvbmji]
2025-06-05 15:03:46 [clientOutboundChannel-36] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:03:46 [clientInboundChannel-54] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=0wnvbmji, lookupDestination='/chat.joinRoom'
2025-06-05 15:03:46 [clientInboundChannel-54] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:03:46 [clientInboundChannel-54] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 15:03:46 [clientInboundChannel-54] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:03:46 [clientInboundChannel-54] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 15:03:46 [clientInboundChannel-54] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:03:46.556122800]
2025-06-05 15:03:46 [clientInboundChannel-54] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:03:46 [clientInboundChannel-54] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:03:46 [clientInboundChannel-54] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:03:46 [clientInboundChannel-54] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:03:46 [clientInboundChannel-54] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:03:46 [clientInboundChannel-54] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:03:46 [clientInboundChannel-54] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107026555]
2025-06-05 15:03:46 [clientInboundChannel-54] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:03:46 [clientInboundChannel-54] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:03:46.556122800]
2025-06-05 15:03:46 [http-nio-8015-exec-10] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:03:46 [http-nio-8015-exec-1] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:03:46 [http-nio-8015-exec-1] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:03:46 [http-nio-8015-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:03:46 [http-nio-8015-exec-1] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:03:46 [http-nio-8015-exec-1] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:03:46 [http-nio-8015-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:03:46 [http-nio-8015-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:03:46 [http-nio-8015-exec-1] INFO  c.e.demo.service.ChatMessageService - 成功獲取 25 條消息
2025-06-05 15:03:46 [http-nio-8015-exec-1] INFO  c.e.d.controller.ChatRoomController - 成功獲取 25 條消息
2025-06-05 15:03:48 [http-nio-8015-exec-2] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=0wnvbmji] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:03:48 [http-nio-8015-exec-2] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session 0wnvbmji
2025-06-05 15:03:48 [http-nio-8015-exec-2] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 15:03:48 [clientOutboundChannel-39] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@4811a8b2, simpSessionId=0wnvbmji}], simpSessionId=0wnvbmji}]
2025-06-05 15:03:48 [clientOutboundChannel-40] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=0wnvbmji}], simpSessionId=0wnvbmji}]
2025-06-05 15:03:48 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:48 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107028276
2025-06-05 15:03:48 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:48 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/284/it5fskca/websocket
2025-06-05 15:03:48 [http-nio-8015-exec-6] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=it5fskca]
2025-06-05 15:03:48 [clientOutboundChannel-41] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:03:48 [clientInboundChannel-66] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=it5fskca, lookupDestination='/chat.joinRoom'
2025-06-05 15:03:48 [clientInboundChannel-66] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:03:48 [clientInboundChannel-66] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 15:03:48 [clientInboundChannel-66] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:03:48 [clientInboundChannel-66] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 15:03:48 [clientInboundChannel-66] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:03:48.352890200]
2025-06-05 15:03:48 [clientInboundChannel-66] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:03:48 [clientInboundChannel-66] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:03:48 [clientInboundChannel-66] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:03:48 [clientInboundChannel-66] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:03:48 [clientInboundChannel-66] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:03:48 [clientInboundChannel-66] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:03:48 [clientInboundChannel-66] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107028352]
2025-06-05 15:03:48 [clientInboundChannel-66] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:03:48 [clientInboundChannel-66] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:03:48.352890200]
2025-06-05 15:03:48 [http-nio-8015-exec-10] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:03:48 [http-nio-8015-exec-10] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:03:48 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:03:48 [http-nio-8015-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:03:48 [http-nio-8015-exec-10] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:03:48 [http-nio-8015-exec-10] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:03:48 [http-nio-8015-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:03:48 [http-nio-8015-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:03:48 [http-nio-8015-exec-10] INFO  c.e.demo.service.ChatMessageService - 成功獲取 26 條消息
2025-06-05 15:03:48 [http-nio-8015-exec-10] INFO  c.e.d.controller.ChatRoomController - 成功獲取 26 條消息
2025-06-05 15:03:49 [http-nio-8015-exec-1] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=it5fskca] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:03:49 [http-nio-8015-exec-1] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session it5fskca
2025-06-05 15:03:49 [http-nio-8015-exec-1] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 15:03:49 [clientOutboundChannel-44] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@2e6d8712, simpSessionId=it5fskca}], simpSessionId=it5fskca}]
2025-06-05 15:03:49 [clientOutboundChannel-45] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=it5fskca}], simpSessionId=it5fskca}]
2025-06-05 15:03:49 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:49 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107029759
2025-06-05 15:03:49 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:49 [http-nio-8015-exec-5] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/018/avg3ozzf/websocket
2025-06-05 15:03:49 [http-nio-8015-exec-5] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=avg3ozzf]
2025-06-05 15:03:49 [clientOutboundChannel-46] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:03:49 [clientInboundChannel-74] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=avg3ozzf, lookupDestination='/chat.joinRoom'
2025-06-05 15:03:49 [clientInboundChannel-74] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:03:49 [clientInboundChannel-74] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 15:03:49 [http-nio-8015-exec-9] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:03:49 [clientInboundChannel-74] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:03:49 [clientInboundChannel-74] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 15:03:49 [clientInboundChannel-74] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:03:49.837179600]
2025-06-05 15:03:49 [clientInboundChannel-74] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:03:49 [clientInboundChannel-74] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:03:49 [clientInboundChannel-74] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:03:49 [clientInboundChannel-74] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:03:49 [clientInboundChannel-74] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:03:49 [clientInboundChannel-74] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:03:49 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:03:49 [clientInboundChannel-74] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107029834]
2025-06-05 15:03:49 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:03:49 [clientInboundChannel-74] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:03:49 [clientInboundChannel-74] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:03:49.837179600]
2025-06-05 15:03:49 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:03:49 [http-nio-8015-exec-9] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:03:49 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:03:49 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:03:49 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:03:49 [http-nio-8015-exec-9] INFO  c.e.demo.service.ChatMessageService - 成功獲取 26 條消息
2025-06-05 15:03:49 [http-nio-8015-exec-9] INFO  c.e.d.controller.ChatRoomController - 成功獲取 26 條消息
2025-06-05 15:03:54 [http-nio-8015-exec-10] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=rt14t04x] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:03:54 [http-nio-8015-exec-10] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session rt14t04x
2025-06-05 15:03:54 [http-nio-8015-exec-10] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 15:03:54 [clientOutboundChannel-49] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@a20d24, simpSessionId=rt14t04x}], simpSessionId=rt14t04x}]
2025-06-05 15:03:54 [clientOutboundChannel-50] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=rt14t04x}], simpSessionId=rt14t04x}]
2025-06-05 15:03:55 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:55 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107035013
2025-06-05 15:03:55 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:55 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/597/ptlg0dy3/websocket
2025-06-05 15:03:55 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=ptlg0dy3]
2025-06-05 15:03:55 [clientOutboundChannel-51] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:03:55 [clientInboundChannel-47] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=ptlg0dy3, lookupDestination='/chat.joinRoom'
2025-06-05 15:03:55 [clientInboundChannel-47] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:03:55 [clientInboundChannel-47] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 15:03:55 [http-nio-8015-exec-8] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:03:55 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:03:55 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:03:55 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:03:55 [clientInboundChannel-47] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:03:55 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 15:03:55 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:03:55.096362400]
2025-06-05 15:03:55 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:03:55 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:03:55 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:03:55 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:03:55 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:03:55 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:03:55 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107035092]
2025-06-05 15:03:55 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:03:55 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:03:55.096362400]
2025-06-05 15:03:55 [http-nio-8015-exec-8] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:03:55 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:03:55 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:03:55 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:03:55 [http-nio-8015-exec-8] INFO  c.e.demo.service.ChatMessageService - 成功獲取 28 條消息
2025-06-05 15:03:55 [http-nio-8015-exec-8] INFO  c.e.d.controller.ChatRoomController - 成功獲取 28 條消息
2025-06-05 15:03:56 [MessageBroker-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 3 sessions: [it5fskca, 2po0gpv0, 0wnvbmji]
2025-06-05 15:03:56 [http-nio-8015-exec-9] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=ptlg0dy3] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:03:56 [http-nio-8015-exec-9] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session ptlg0dy3
2025-06-05 15:03:56 [http-nio-8015-exec-9] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 15:03:56 [clientOutboundChannel-54] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@11112c7f, simpSessionId=ptlg0dy3}], simpSessionId=ptlg0dy3}]
2025-06-05 15:03:56 [clientOutboundChannel-55] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=ptlg0dy3}], simpSessionId=ptlg0dy3}]
2025-06-05 15:03:56 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:56 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107036420
2025-06-05 15:03:56 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:56 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/527/1w52fcxp/websocket
2025-06-05 15:03:56 [http-nio-8015-exec-2] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=1w52fcxp]
2025-06-05 15:03:56 [clientOutboundChannel-56] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:03:56 [clientInboundChannel-63] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=1w52fcxp, lookupDestination='/chat.joinRoom'
2025-06-05 15:03:56 [clientInboundChannel-63] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:03:56 [clientInboundChannel-63] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 15:03:56 [clientInboundChannel-63] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:03:56 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 15:03:56 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:03:56.515537400]
2025-06-05 15:03:56 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:03:56 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:03:56 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:03:56 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:03:56 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:03:56 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:03:56 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107036512]
2025-06-05 15:03:56 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:03:56 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:03:56.515537400]
2025-06-05 15:03:56 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:03:56 [http-nio-8015-exec-7] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:03:56 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:03:56 [http-nio-8015-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:03:56 [http-nio-8015-exec-7] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:03:56 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:03:56 [http-nio-8015-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:03:56 [http-nio-8015-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:03:56 [http-nio-8015-exec-7] INFO  c.e.demo.service.ChatMessageService - 成功獲取 29 條消息
2025-06-05 15:03:56 [http-nio-8015-exec-7] INFO  c.e.d.controller.ChatRoomController - 成功獲取 29 條消息
2025-06-05 15:03:57 [http-nio-8015-exec-8] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=1w52fcxp] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:03:57 [http-nio-8015-exec-8] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session 1w52fcxp
2025-06-05 15:03:57 [http-nio-8015-exec-8] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 15:03:57 [clientOutboundChannel-59] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@65389e7e, simpSessionId=1w52fcxp}], simpSessionId=1w52fcxp}]
2025-06-05 15:03:57 [clientOutboundChannel-60] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=1w52fcxp}], simpSessionId=1w52fcxp}]
2025-06-05 15:03:57 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:57 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107037659
2025-06-05 15:03:57 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:03:57 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/620/wz3xjw4y/websocket
2025-06-05 15:03:57 [http-nio-8015-exec-4] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=wz3xjw4y]
2025-06-05 15:03:57 [clientOutboundChannel-61] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:03:57 [clientInboundChannel-71] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=wz3xjw4y, lookupDestination='/chat.joinRoom'
2025-06-05 15:03:57 [clientInboundChannel-71] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:03:57 [clientInboundChannel-71] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 15:03:57 [http-nio-8015-exec-6] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:03:57 [http-nio-8015-exec-5] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:03:57 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:03:57 [clientInboundChannel-71] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:03:57 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 15:03:57 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:03:57.741605800]
2025-06-05 15:03:57 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:03:57 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:03:57 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:03:57 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:03:57 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:03:57 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:03:57 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:03:57 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107037738]
2025-06-05 15:03:57 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:03:57 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:03:57.741605800]
2025-06-05 15:03:57 [http-nio-8015-exec-6] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:03:57 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:03:57 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:03:57 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:03:57 [http-nio-8015-exec-6] INFO  c.e.demo.service.ChatMessageService - 成功獲取 30 條消息
2025-06-05 15:03:57 [http-nio-8015-exec-6] INFO  c.e.d.controller.ChatRoomController - 成功獲取 30 條消息
2025-06-05 15:04:01 [MessageBroker-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [rt14t04x]
2025-06-05 15:04:05 [clientInboundChannel-75] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=avg3ozzf, lookupDestination='/chat.sendMessage'
2025-06-05 15:04:05 [clientInboundChannel-75] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 15:04:05 [clientInboundChannel-75] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 558585858 from Jared in room 1
2025-06-05 15:04:05 [clientInboundChannel-75] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:04:05 [clientInboundChannel-75] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [558585858]
2025-06-05 15:04:05 [clientInboundChannel-75] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:04:05.508923200]
2025-06-05 15:04:05 [clientInboundChannel-75] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:04:05 [clientInboundChannel-75] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:04:05 [clientInboundChannel-75] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:04:05 [clientInboundChannel-75] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:04:05 [clientInboundChannel-75] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:04:05 [clientInboundChannel-75] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:04:05 [clientInboundChannel-75] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107045506]
2025-06-05 15:04:05 [clientInboundChannel-75] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 15:04:05 [clientInboundChannel-75] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:04:05.508923200]
2025-06-05 15:04:05 [clientInboundChannel-75] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 31
2025-06-05 15:04:06 [MessageBroker-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 2 sessions: [1w52fcxp, ptlg0dy3]
2025-06-05 15:04:11 [http-nio-8015-exec-8] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=wz3xjw4y] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:04:11 [http-nio-8015-exec-8] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session wz3xjw4y
2025-06-05 15:04:11 [http-nio-8015-exec-8] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 15:04:11 [clientOutboundChannel-66] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@7437a3fe, simpSessionId=wz3xjw4y}], simpSessionId=wz3xjw4y}]
2025-06-05 15:04:11 [clientOutboundChannel-67] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=wz3xjw4y}], simpSessionId=wz3xjw4y}]
2025-06-05 15:04:17 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:17 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107057034
2025-06-05 15:04:17 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:17 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/122/h5e4ffk5/websocket
2025-06-05 15:04:17 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=h5e4ffk5]
2025-06-05 15:04:17 [clientOutboundChannel-68] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:04:17 [clientInboundChannel-48] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=h5e4ffk5, lookupDestination='/chat.joinRoom'
2025-06-05 15:04:17 [clientInboundChannel-48] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:04:17 [clientInboundChannel-48] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 15:04:17 [http-nio-8015-exec-8] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:04:17 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:04:17 [clientInboundChannel-48] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:04:17 [clientInboundChannel-48] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 15:04:17 [clientInboundChannel-48] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:04:17.115067100]
2025-06-05 15:04:17 [clientInboundChannel-48] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:04:17 [clientInboundChannel-48] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:04:17 [clientInboundChannel-48] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:04:17 [clientInboundChannel-48] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:04:17 [clientInboundChannel-48] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:04:17 [clientInboundChannel-48] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:04:17 [clientInboundChannel-48] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107057112]
2025-06-05 15:04:17 [clientInboundChannel-48] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:04:17 [clientInboundChannel-48] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:04:17.115067100]
2025-06-05 15:04:17 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:04:17 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:04:17 [http-nio-8015-exec-8] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:04:17 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:04:17 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:04:17 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:04:17 [http-nio-8015-exec-8] INFO  c.e.demo.service.ChatMessageService - 成功獲取 32 條消息
2025-06-05 15:04:17 [http-nio-8015-exec-8] INFO  c.e.d.controller.ChatRoomController - 成功獲取 32 條消息
2025-06-05 15:04:21 [MessageBroker-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [wz3xjw4y]
2025-06-05 15:04:22 [clientInboundChannel-47] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=h5e4ffk5, lookupDestination='/chat.sendMessage'
2025-06-05 15:04:22 [clientInboundChannel-47] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 15:04:22 [clientInboundChannel-47] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 5858585 from Leo in room 1
2025-06-05 15:04:22 [clientInboundChannel-47] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:04:22 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [5858585]
2025-06-05 15:04:22 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:04:22.338357700]
2025-06-05 15:04:22 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:04:22 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:04:22 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:04:22 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:04:22 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:04:22 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:04:22 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107062335]
2025-06-05 15:04:22 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 15:04:22 [clientInboundChannel-47] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:04:22.338357700]
2025-06-05 15:04:22 [clientInboundChannel-47] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 33
2025-06-05 15:04:28 [http-nio-8015-exec-10] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=h5e4ffk5] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:04:28 [http-nio-8015-exec-10] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session h5e4ffk5
2025-06-05 15:04:28 [http-nio-8015-exec-10] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 15:04:28 [clientOutboundChannel-73] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@5987302f, simpSessionId=h5e4ffk5}], simpSessionId=h5e4ffk5}]
2025-06-05 15:04:28 [clientOutboundChannel-74] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=h5e4ffk5}], simpSessionId=h5e4ffk5}]
2025-06-05 15:04:28 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:28 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107068388
2025-06-05 15:04:28 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:28 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/198/w5gu45t1/websocket
2025-06-05 15:04:28 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=w5gu45t1]
2025-06-05 15:04:28 [clientOutboundChannel-75] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:04:28 [clientInboundChannel-69] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=w5gu45t1, lookupDestination='/chat.joinRoom'
2025-06-05 15:04:28 [clientInboundChannel-69] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:04:28 [clientInboundChannel-69] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 15:04:28 [http-nio-8015-exec-8] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:04:28 [clientInboundChannel-69] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:04:28 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:04:28 [clientInboundChannel-69] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 15:04:28 [clientInboundChannel-69] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:04:28.473320600]
2025-06-05 15:04:28 [clientInboundChannel-69] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:04:28 [clientInboundChannel-69] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:04:28 [clientInboundChannel-69] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:04:28 [clientInboundChannel-69] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:04:28 [clientInboundChannel-69] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:04:28 [clientInboundChannel-69] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:04:28 [clientInboundChannel-69] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107068470]
2025-06-05 15:04:28 [clientInboundChannel-69] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:04:28 [clientInboundChannel-69] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:04:28.473320600]
2025-06-05 15:04:28 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:04:28 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:04:28 [http-nio-8015-exec-8] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:04:28 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:04:28 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:04:28 [http-nio-8015-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:04:28 [http-nio-8015-exec-8] INFO  c.e.demo.service.ChatMessageService - 成功獲取 34 條消息
2025-06-05 15:04:28 [http-nio-8015-exec-8] INFO  c.e.d.controller.ChatRoomController - 成功獲取 34 條消息
2025-06-05 15:04:30 [http-nio-8015-exec-9] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=w5gu45t1] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:04:30 [http-nio-8015-exec-9] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session w5gu45t1
2025-06-05 15:04:30 [http-nio-8015-exec-9] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 15:04:30 [clientOutboundChannel-78] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@24bc2009, simpSessionId=w5gu45t1}], simpSessionId=w5gu45t1}]
2025-06-05 15:04:30 [clientOutboundChannel-79] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=w5gu45t1}], simpSessionId=w5gu45t1}]
2025-06-05 15:04:30 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:30 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107070221
2025-06-05 15:04:30 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:30 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/918/edh311th/websocket
2025-06-05 15:04:30 [http-nio-8015-exec-2] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=edh311th]
2025-06-05 15:04:30 [clientOutboundChannel-32] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:04:30 [clientInboundChannel-71] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=edh311th, lookupDestination='/chat.joinRoom'
2025-06-05 15:04:30 [clientInboundChannel-71] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:04:30 [clientInboundChannel-71] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 15:04:30 [clientInboundChannel-71] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:04:30 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 15:04:30 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:04:30.296496400]
2025-06-05 15:04:30 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:04:30 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:04:30 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:04:30 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:04:30 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:04:30 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:04:30 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107070294]
2025-06-05 15:04:30 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:04:30 [clientInboundChannel-71] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:04:30.296496400]
2025-06-05 15:04:30 [http-nio-8015-exec-7] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:04:30 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:04:30 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:04:30 [http-nio-8015-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:04:30 [http-nio-8015-exec-7] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:04:30 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:04:30 [http-nio-8015-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:04:30 [http-nio-8015-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:04:30 [http-nio-8015-exec-7] INFO  c.e.demo.service.ChatMessageService - 成功獲取 35 條消息
2025-06-05 15:04:30 [http-nio-8015-exec-7] INFO  c.e.d.controller.ChatRoomController - 成功獲取 35 條消息
2025-06-05 15:04:33 [http-nio-8015-exec-8] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=avg3ozzf] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:04:33 [http-nio-8015-exec-8] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session avg3ozzf
2025-06-05 15:04:33 [http-nio-8015-exec-8] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 15:04:33 [clientOutboundChannel-35] DEBUG o.s.w.s.m.StompSubProtocolHandler - Failed to send WebSocket message to client in session avg3ozzf
java.lang.IllegalStateException: Cannot send a message when session is closed
	at org.springframework.util.Assert.state(Assert.java:79)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.sendMessage(AbstractSockJsSession.java:144)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.tryFlushMessageBuffer(ConcurrentWebSocketSessionDecorator.java:190)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.sendMessage(ConcurrentWebSocketSessionDecorator.java:163)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.sendToClient(StompSubProtocolHandler.java:529)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.handleMessageToClient(StompSubProtocolHandler.java:516)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.handleMessage(SubProtocolWebSocketHandler.java:387)
	at org.springframework.messaging.support.ExecutorSubscribableChannel$SendTask.run(ExecutorSubscribableChannel.java:152)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-06-05 15:04:33 [clientOutboundChannel-36] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=avg3ozzf}], simpSessionId=avg3ozzf}]
2025-06-05 15:04:33 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:33 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107073481
2025-06-05 15:04:33 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:33 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/806/jigzkuku/websocket
2025-06-05 15:04:33 [http-nio-8015-exec-4] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=jigzkuku]
2025-06-05 15:04:33 [clientOutboundChannel-37] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:04:33 [clientInboundChannel-46] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=jigzkuku, lookupDestination='/chat.joinRoom'
2025-06-05 15:04:33 [clientInboundChannel-46] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:04:33 [clientInboundChannel-46] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 15:04:33 [clientInboundChannel-46] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:04:33 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 15:04:33 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:04:33.552438800]
2025-06-05 15:04:33 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:04:33 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:04:33 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:04:33 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:04:33 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:04:33 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:04:33 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107073549]
2025-06-05 15:04:33 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:04:33 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:04:33.552438800]
2025-06-05 15:04:33 [http-nio-8015-exec-5] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:04:33 [http-nio-8015-exec-6] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:04:33 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:04:33 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:04:33 [http-nio-8015-exec-6] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:04:33 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:04:33 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:04:33 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:04:33 [http-nio-8015-exec-6] INFO  c.e.demo.service.ChatMessageService - 成功獲取 36 條消息
2025-06-05 15:04:33 [http-nio-8015-exec-6] INFO  c.e.d.controller.ChatRoomController - 成功獲取 36 條消息
2025-06-05 15:04:34 [http-nio-8015-exec-7] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=jigzkuku] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:04:34 [http-nio-8015-exec-7] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session jigzkuku
2025-06-05 15:04:34 [http-nio-8015-exec-7] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 15:04:34 [clientOutboundChannel-40] DEBUG o.s.w.s.m.StompSubProtocolHandler - Failed to send WebSocket message to client in session jigzkuku
java.lang.IllegalStateException: Cannot send a message when session is closed
	at org.springframework.util.Assert.state(Assert.java:79)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.sendMessage(AbstractSockJsSession.java:144)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.tryFlushMessageBuffer(ConcurrentWebSocketSessionDecorator.java:190)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.sendMessage(ConcurrentWebSocketSessionDecorator.java:163)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.sendToClient(StompSubProtocolHandler.java:529)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.handleMessageToClient(StompSubProtocolHandler.java:516)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.handleMessage(SubProtocolWebSocketHandler.java:387)
	at org.springframework.messaging.support.ExecutorSubscribableChannel$SendTask.run(ExecutorSubscribableChannel.java:152)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:842)
2025-06-05 15:04:34 [clientOutboundChannel-41] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=jigzkuku}], simpSessionId=jigzkuku}]
2025-06-05 15:04:34 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:34 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107074758
2025-06-05 15:04:34 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:34 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/727/baj31a2v/websocket
2025-06-05 15:04:34 [http-nio-8015-exec-1] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=baj31a2v]
2025-06-05 15:04:34 [clientOutboundChannel-42] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:04:34 [clientInboundChannel-63] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=baj31a2v, lookupDestination='/chat.joinRoom'
2025-06-05 15:04:34 [clientInboundChannel-63] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:04:34 [clientInboundChannel-63] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 15:04:34 [http-nio-8015-exec-5] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:04:34 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:04:34 [clientInboundChannel-63] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:04:34 [http-nio-8015-exec-5] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:04:34 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 15:04:34 [http-nio-8015-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:04:34 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:04:34.836802300]
2025-06-05 15:04:34 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:04:34 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:04:34 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:04:34 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:04:34 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:04:34 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:04:34 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107074834]
2025-06-05 15:04:34 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:04:34 [clientInboundChannel-63] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:04:34.836802300]
2025-06-05 15:04:34 [http-nio-8015-exec-5] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:04:34 [http-nio-8015-exec-5] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:04:34 [http-nio-8015-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:04:34 [http-nio-8015-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:04:34 [http-nio-8015-exec-5] INFO  c.e.demo.service.ChatMessageService - 成功獲取 37 條消息
2025-06-05 15:04:34 [http-nio-8015-exec-5] INFO  c.e.d.controller.ChatRoomController - 成功獲取 37 條消息
2025-06-05 15:04:35 [http-nio-8015-exec-6] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=baj31a2v] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:04:35 [http-nio-8015-exec-6] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session baj31a2v
2025-06-05 15:04:35 [clientOutboundChannel-45] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@24bffc10, simpSessionId=baj31a2v}], simpSessionId=baj31a2v}]
2025-06-05 15:04:35 [http-nio-8015-exec-6] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 15:04:35 [clientOutboundChannel-46] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=baj31a2v}], simpSessionId=baj31a2v}]
2025-06-05 15:04:35 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:35 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107075979
2025-06-05 15:04:36 [MessageBroker-14] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 2 sessions: [w5gu45t1, h5e4ffk5]
2025-06-05 15:04:36 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:04:36 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/783/arubxlkm/websocket
2025-06-05 15:04:36 [http-nio-8015-exec-10] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=arubxlkm]
2025-06-05 15:04:36 [clientOutboundChannel-47] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:04:36 [clientInboundChannel-72] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=arubxlkm, lookupDestination='/chat.joinRoom'
2025-06-05 15:04:36 [clientInboundChannel-72] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:04:36 [clientInboundChannel-72] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 15:04:36 [clientInboundChannel-72] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:04:36 [clientInboundChannel-72] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 15:04:36 [clientInboundChannel-72] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:04:36.050710]
2025-06-05 15:04:36 [http-nio-8015-exec-3] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:04:36 [clientInboundChannel-72] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:04:36 [clientInboundChannel-72] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:04:36 [clientInboundChannel-72] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:04:36 [clientInboundChannel-72] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:04:36 [clientInboundChannel-72] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:04:36 [clientInboundChannel-72] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:04:36 [clientInboundChannel-72] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107076050]
2025-06-05 15:04:36 [clientInboundChannel-72] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:04:36 [clientInboundChannel-72] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:04:36.050710]
2025-06-05 15:04:36 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:04:36 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:04:36 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:04:36 [http-nio-8015-exec-3] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:04:36 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:04:36 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:04:36 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:04:36 [http-nio-8015-exec-3] INFO  c.e.demo.service.ChatMessageService - 成功獲取 38 條消息
2025-06-05 15:04:36 [http-nio-8015-exec-3] INFO  c.e.d.controller.ChatRoomController - 成功獲取 38 條消息
2025-06-05 15:04:41 [MessageBroker-14] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 3 sessions: [jigzkuku, baj31a2v, avg3ozzf]
2025-06-05 15:05:31 [http-nio-8015-exec-5] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=arubxlkm] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:05:31 [http-nio-8015-exec-5] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session arubxlkm
2025-06-05 15:05:31 [http-nio-8015-exec-5] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 15:05:31 [clientOutboundChannel-80] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@35c7faa3, simpSessionId=arubxlkm}], simpSessionId=arubxlkm}]
2025-06-05 15:05:31 [clientOutboundChannel-81] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=arubxlkm}], simpSessionId=arubxlkm}]
2025-06-05 15:05:32 [http-nio-8015-exec-8] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:05:32 [http-nio-8015-exec-8] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107132035
2025-06-05 15:05:32 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:05:32 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/931/v1psonol/websocket
2025-06-05 15:05:32 [http-nio-8015-exec-9] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=v1psonol]
2025-06-05 15:05:32 [clientOutboundChannel-82] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:05:32 [http-nio-8015-exec-2] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:05:32 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:05:32 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:05:32 [clientInboundChannel-98] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=v1psonol, lookupDestination='/chat.joinRoom'
2025-06-05 15:05:32 [http-nio-8015-exec-4] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:05:32 [clientInboundChannel-98] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:05:32 [clientInboundChannel-98] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 15:05:32 [clientInboundChannel-98] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:05:32 [clientInboundChannel-98] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 15:05:32 [clientInboundChannel-98] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:05:32.163570500]
2025-06-05 15:05:32 [clientInboundChannel-98] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:05:32 [clientInboundChannel-98] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:05:32 [clientInboundChannel-98] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:05:32 [clientInboundChannel-98] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:05:32 [clientInboundChannel-98] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:05:32 [clientInboundChannel-98] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:05:32 [clientInboundChannel-98] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107132160]
2025-06-05 15:05:32 [http-nio-8015-exec-2] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:05:32 [clientInboundChannel-98] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:05:32 [clientInboundChannel-98] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:05:32.163570500]
2025-06-05 15:05:32 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:05:32 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:05:32 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:05:32 [http-nio-8015-exec-2] INFO  c.e.demo.service.ChatMessageService - 成功獲取 38 條消息
2025-06-05 15:05:32 [http-nio-8015-exec-2] INFO  c.e.d.controller.ChatRoomController - 成功獲取 38 條消息
2025-06-05 15:05:38 [clientInboundChannel-101] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=v1psonol, lookupDestination='/chat.sendMessage'
2025-06-05 15:05:38 [clientInboundChannel-101] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 15:05:38 [clientInboundChannel-101] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 2525252 from Leo in room 1
2025-06-05 15:05:38 [clientInboundChannel-101] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:05:38 [clientInboundChannel-101] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [2525252]
2025-06-05 15:05:38 [clientInboundChannel-101] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:05:38.875230900]
2025-06-05 15:05:38 [clientInboundChannel-101] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:05:38 [clientInboundChannel-101] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:05:38 [clientInboundChannel-101] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:05:38 [clientInboundChannel-101] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:05:38 [clientInboundChannel-101] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:05:38 [clientInboundChannel-101] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:05:38 [clientInboundChannel-101] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107138872]
2025-06-05 15:05:38 [clientInboundChannel-101] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 15:05:38 [clientInboundChannel-101] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:05:38.875230900]
2025-06-05 15:05:38 [clientInboundChannel-101] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 40
2025-06-05 15:05:41 [MessageBroker-7] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [arubxlkm]
2025-06-05 15:05:43 [http-nio-8015-exec-6] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=edh311th] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:05:43 [http-nio-8015-exec-6] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session edh311th
2025-06-05 15:05:43 [http-nio-8015-exec-6] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 15:05:43 [clientOutboundChannel-87] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@210809aa, simpSessionId=edh311th}], simpSessionId=edh311th}]
2025-06-05 15:05:43 [clientOutboundChannel-88] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=edh311th}], simpSessionId=edh311th}]
2025-06-05 15:05:51 [MessageBroker-7] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [edh311th]
2025-06-05 15:05:51 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:05:51 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107151135
2025-06-05 15:05:51 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:05:51 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/857/g1ouqxcr/websocket
2025-06-05 15:05:51 [http-nio-8015-exec-1] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=g1ouqxcr]
2025-06-05 15:05:51 [clientOutboundChannel-89] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:05:51 [http-nio-8015-exec-6] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:05:51 [clientInboundChannel-116] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=g1ouqxcr, lookupDestination='/chat.joinRoom'
2025-06-05 15:05:51 [clientInboundChannel-116] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:05:51 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:05:51 [clientInboundChannel-116] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 15:05:51 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:05:51 [clientInboundChannel-116] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:05:51 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:05:51 [clientInboundChannel-116] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 15:05:51 [clientInboundChannel-116] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:05:51.250662400]
2025-06-05 15:05:51 [clientInboundChannel-116] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:05:51 [clientInboundChannel-116] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:05:51 [clientInboundChannel-116] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:05:51 [clientInboundChannel-116] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:05:51 [clientInboundChannel-116] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:05:51 [clientInboundChannel-116] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:05:51 [clientInboundChannel-116] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107151247]
2025-06-05 15:05:51 [clientInboundChannel-116] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:05:51 [clientInboundChannel-116] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:05:51.250662400]
2025-06-05 15:05:51 [http-nio-8015-exec-6] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:05:51 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:05:51 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:05:51 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:05:51 [http-nio-8015-exec-6] INFO  c.e.demo.service.ChatMessageService - 成功獲取 41 條消息
2025-06-05 15:05:51 [http-nio-8015-exec-6] INFO  c.e.d.controller.ChatRoomController - 成功獲取 41 條消息
2025-06-05 15:05:59 [clientInboundChannel-119] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=v1psonol, lookupDestination='/chat.sendMessage'
2025-06-05 15:05:59 [clientInboundChannel-119] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 15:05:59 [clientInboundChannel-119] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 558585858 from Leo in room 1
2025-06-05 15:05:59 [clientInboundChannel-119] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:05:59 [clientInboundChannel-119] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [558585858]
2025-06-05 15:05:59 [clientInboundChannel-119] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:05:59.148306]
2025-06-05 15:05:59 [clientInboundChannel-119] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:05:59 [clientInboundChannel-119] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:05:59 [clientInboundChannel-119] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:05:59 [clientInboundChannel-119] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:05:59 [clientInboundChannel-119] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:05:59 [clientInboundChannel-119] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:05:59 [clientInboundChannel-119] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107159143]
2025-06-05 15:05:59 [clientInboundChannel-119] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 15:05:59 [clientInboundChannel-119] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:05:59.148306]
2025-06-05 15:05:59 [clientInboundChannel-119] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 42
2025-06-05 15:06:03 [http-nio-8015-exec-7] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=g1ouqxcr] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:06:03 [http-nio-8015-exec-7] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session g1ouqxcr
2025-06-05 15:06:03 [http-nio-8015-exec-7] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 15:06:03 [clientOutboundChannel-94] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@64312377, simpSessionId=g1ouqxcr}], simpSessionId=g1ouqxcr}]
2025-06-05 15:06:03 [clientOutboundChannel-95] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=g1ouqxcr}], simpSessionId=g1ouqxcr}]
2025-06-05 15:06:04 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:06:04 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107164057
2025-06-05 15:06:04 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:06:04 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/302/isrq1dfb/websocket
2025-06-05 15:06:04 [http-nio-8015-exec-1] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=isrq1dfb]
2025-06-05 15:06:04 [clientOutboundChannel-96] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:06:04 [clientInboundChannel-86] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=isrq1dfb, lookupDestination='/chat.joinRoom'
2025-06-05 15:06:04 [clientInboundChannel-86] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:06:04 [clientInboundChannel-86] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 15:06:04 [http-nio-8015-exec-6] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:06:04 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:06:04 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:06:04 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:06:04 [clientInboundChannel-86] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:06:04 [clientInboundChannel-86] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 15:06:04 [clientInboundChannel-86] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:06:04.137221400]
2025-06-05 15:06:04 [clientInboundChannel-86] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:06:04 [clientInboundChannel-86] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:06:04 [clientInboundChannel-86] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:06:04 [clientInboundChannel-86] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:06:04 [clientInboundChannel-86] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:06:04 [clientInboundChannel-86] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:06:04 [clientInboundChannel-86] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107164134]
2025-06-05 15:06:04 [clientInboundChannel-86] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:06:04 [clientInboundChannel-86] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:06:04.137221400]
2025-06-05 15:06:04 [http-nio-8015-exec-6] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:06:04 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:06:04 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:06:04 [http-nio-8015-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:06:04 [http-nio-8015-exec-6] INFO  c.e.demo.service.ChatMessageService - 成功獲取 42 條消息
2025-06-05 15:06:04 [http-nio-8015-exec-6] INFO  c.e.d.controller.ChatRoomController - 成功獲取 42 條消息
2025-06-05 15:06:08 [http-nio-8015-exec-5] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=isrq1dfb] closed with CloseStatus[code=1000, reason=null]
2025-06-05 15:06:08 [http-nio-8015-exec-5] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session isrq1dfb
2025-06-05 15:06:08 [http-nio-8015-exec-5] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 15:06:08 [clientOutboundChannel-99] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@3c3405b9, simpSessionId=isrq1dfb}], simpSessionId=isrq1dfb}]
2025-06-05 15:06:08 [clientOutboundChannel-100] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=isrq1dfb}], simpSessionId=isrq1dfb}]
2025-06-05 15:06:08 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:06:08 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749107168806
2025-06-05 15:06:08 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 15:06:08 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/909/adyb5vqd/websocket
2025-06-05 15:06:08 [http-nio-8015-exec-10] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=adyb5vqd]
2025-06-05 15:06:08 [clientOutboundChannel-101] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 15:06:08 [clientInboundChannel-102] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=adyb5vqd, lookupDestination='/chat.joinRoom'
2025-06-05 15:06:08 [clientInboundChannel-102] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 15:06:08 [clientInboundChannel-102] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 15:06:08 [http-nio-8015-exec-3] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 15:06:08 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 15:06:08 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 15:06:08 [clientInboundChannel-102] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:06:08 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 15:06:08 [clientInboundChannel-102] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 15:06:08 [clientInboundChannel-102] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:06:08.881444800]
2025-06-05 15:06:08 [clientInboundChannel-102] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:06:08 [clientInboundChannel-102] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:06:08 [clientInboundChannel-102] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:06:08 [clientInboundChannel-102] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:06:08 [clientInboundChannel-102] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:06:08 [clientInboundChannel-102] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:06:08 [clientInboundChannel-102] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107168879]
2025-06-05 15:06:08 [clientInboundChannel-102] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 15:06:08 [clientInboundChannel-102] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:06:08.881444800]
2025-06-05 15:06:08 [http-nio-8015-exec-3] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 15:06:08 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 15:06:08 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 15:06:08 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 15:06:08 [http-nio-8015-exec-3] INFO  c.e.demo.service.ChatMessageService - 成功獲取 43 條消息
2025-06-05 15:06:08 [http-nio-8015-exec-3] INFO  c.e.d.controller.ChatRoomController - 成功獲取 43 條消息
2025-06-05 15:06:11 [MessageBroker-17] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [g1ouqxcr]
2025-06-05 15:06:13 [clientInboundChannel-104] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=v1psonol, lookupDestination='/chat.sendMessage'
2025-06-05 15:06:13 [clientInboundChannel-104] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 15:06:13 [clientInboundChannel-104] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 5585858585 from Leo in room 1
2025-06-05 15:06:13 [clientInboundChannel-104] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:06:13 [clientInboundChannel-104] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [5585858585]
2025-06-05 15:06:13 [clientInboundChannel-104] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:06:13.315091]
2025-06-05 15:06:13 [clientInboundChannel-104] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 15:06:13 [clientInboundChannel-104] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 15:06:13 [clientInboundChannel-104] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 15:06:13 [clientInboundChannel-104] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 15:06:13 [clientInboundChannel-104] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:06:13 [clientInboundChannel-104] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 15:06:13 [clientInboundChannel-104] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107173310]
2025-06-05 15:06:13 [clientInboundChannel-104] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 15:06:13 [clientInboundChannel-104] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:06:13.315091]
2025-06-05 15:06:13 [clientInboundChannel-104] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 45
2025-06-05 15:06:16 [MessageBroker-17] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [isrq1dfb]
2025-06-05 15:06:42 [clientInboundChannel-134] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=adyb5vqd, lookupDestination='/chat.sendMessage'
2025-06-05 15:06:42 [clientInboundChannel-134] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 15:06:42 [clientInboundChannel-134] INFO  c.e.d.c.ChatWebSocketController - 收到訊息:  from Jared in room 1
2025-06-05 15:06:42 [clientInboundChannel-134] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 15:06:42 [clientInboundChannel-134] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [2930029.jpg]
2025-06-05 15:06:42 [clientInboundChannel-134] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T15:06:42.505733400]
2025-06-05 15:06:42 [clientInboundChannel-134] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [2930029.jpg]
2025-06-05 15:06:42 [clientInboundChannel-134] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [26749]
2025-06-05 15:06:42 [clientInboundChannel-134] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [image/jpeg]
2025-06-05 15:06:42 [clientInboundChannel-134] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [/uploads/1/8c93716e-efc7-4b57-8f86-0ec36dacc87f.jpg]
2025-06-05 15:06:42 [clientInboundChannel-134] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 15:06:42 [clientInboundChannel-134] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 15:06:42 [clientInboundChannel-134] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749107202502]
2025-06-05 15:06:42 [clientInboundChannel-134] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [IMAGE]
2025-06-05 15:06:42 [clientInboundChannel-134] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T15:06:42.505733400]
2025-06-05 15:06:42 [clientInboundChannel-134] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 46
2025-06-05 15:32:45 [MessageBroker-7] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 22 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(22)-CONNECTED(22)-DISCONNECT(20)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 348], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 125], sockJsScheduler[pool size = 24, active threads = 1, queued tasks = 3, completed tasks = 503]
2025-06-05 16:02:45 [MessageBroker-17] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 22 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(22)-CONNECTED(22)-DISCONNECT(20)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 348], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 125], sockJsScheduler[pool size = 24, active threads = 1, queued tasks = 3, completed tasks = 1008]
2025-06-05 16:05:43 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=v1psonol] closed with CloseStatus[code=1000, reason=null]
2025-06-05 16:05:43 [http-nio-8015-exec-3] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session v1psonol
2025-06-05 16:05:43 [http-nio-8015-exec-3] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 16:05:43 [clientOutboundChannel-108] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@3f2c829d, simpSessionId=v1psonol}], simpSessionId=v1psonol}]
2025-06-05 16:05:43 [clientOutboundChannel-109] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=v1psonol}], simpSessionId=v1psonol}]
2025-06-05 16:05:43 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 16:05:43 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749110743134
2025-06-05 16:05:43 [http-nio-8015-exec-8] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 16:05:43 [http-nio-8015-exec-8] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/573/ulpdi3sm/websocket
2025-06-05 16:05:43 [http-nio-8015-exec-8] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=ulpdi3sm]
2025-06-05 16:05:43 [clientOutboundChannel-110] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 16:05:43 [http-nio-8015-exec-4] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 16:05:43 [clientInboundChannel-149] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=ulpdi3sm, lookupDestination='/chat.joinRoom'
2025-06-05 16:05:43 [clientInboundChannel-149] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 16:05:43 [http-nio-8015-exec-4] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 16:05:43 [clientInboundChannel-149] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 16:05:43 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 16:05:43 [http-nio-8015-exec-1] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 16:05:43 [clientInboundChannel-149] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 16:05:43 [clientInboundChannel-149] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 16:05:43 [clientInboundChannel-149] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T16:05:43.251177600]
2025-06-05 16:05:43 [clientInboundChannel-149] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 16:05:43 [clientInboundChannel-149] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 16:05:43 [clientInboundChannel-149] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 16:05:43 [clientInboundChannel-149] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 16:05:43 [clientInboundChannel-149] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 16:05:43 [clientInboundChannel-149] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 16:05:43 [clientInboundChannel-149] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749110743248]
2025-06-05 16:05:43 [clientInboundChannel-149] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 16:05:43 [clientInboundChannel-149] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T16:05:43.251177600]
2025-06-05 16:05:43 [http-nio-8015-exec-4] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 16:05:43 [http-nio-8015-exec-4] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 16:05:43 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 16:05:43 [http-nio-8015-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 16:05:43 [http-nio-8015-exec-4] INFO  c.e.demo.service.ChatMessageService - 成功獲取 46 條消息
2025-06-05 16:05:43 [http-nio-8015-exec-4] INFO  c.e.d.controller.ChatRoomController - 成功獲取 46 條消息
2025-06-05 16:05:47 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=ulpdi3sm] closed with CloseStatus[code=1000, reason=null]
2025-06-05 16:05:47 [http-nio-8015-exec-3] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session ulpdi3sm
2025-06-05 16:05:47 [http-nio-8015-exec-3] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 16:05:47 [clientOutboundChannel-113] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@337262d7, simpSessionId=ulpdi3sm}], simpSessionId=ulpdi3sm}]
2025-06-05 16:05:47 [clientOutboundChannel-114] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=ulpdi3sm}], simpSessionId=ulpdi3sm}]
2025-06-05 16:05:51 [MessageBroker-6] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [v1psonol]
2025-06-05 16:05:53 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 16:05:53 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749110753539
2025-06-05 16:05:53 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 16:05:53 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/919/r2qzlamr/websocket
2025-06-05 16:05:53 [http-nio-8015-exec-10] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=r2qzlamr]
2025-06-05 16:05:53 [clientOutboundChannel-115] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 16:05:53 [http-nio-8015-exec-3] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 16:05:53 [clientInboundChannel-164] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=r2qzlamr, lookupDestination='/chat.joinRoom'
2025-06-05 16:05:53 [clientInboundChannel-164] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 16:05:53 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 16:05:53 [clientInboundChannel-164] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 16:05:53 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 16:05:53 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 16:05:53 [clientInboundChannel-164] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 16:05:53 [clientInboundChannel-164] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 16:05:53 [clientInboundChannel-164] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T16:05:53.627345400]
2025-06-05 16:05:53 [clientInboundChannel-164] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 16:05:53 [clientInboundChannel-164] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 16:05:53 [clientInboundChannel-164] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 16:05:53 [clientInboundChannel-164] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 16:05:53 [clientInboundChannel-164] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 16:05:53 [clientInboundChannel-164] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 16:05:53 [clientInboundChannel-164] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749110753625]
2025-06-05 16:05:53 [clientInboundChannel-164] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 16:05:53 [clientInboundChannel-164] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T16:05:53.627345400]
2025-06-05 16:05:53 [http-nio-8015-exec-3] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 16:05:53 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 16:05:53 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 16:05:53 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 16:05:53 [http-nio-8015-exec-3] INFO  c.e.demo.service.ChatMessageService - 成功獲取 47 條消息
2025-06-05 16:05:53 [http-nio-8015-exec-3] INFO  c.e.d.controller.ChatRoomController - 成功獲取 47 條消息
2025-06-05 16:05:56 [MessageBroker-6] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [ulpdi3sm]
2025-06-05 16:06:04 [http-nio-8015-exec-5] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=adyb5vqd] closed with CloseStatus[code=1000, reason=null]
2025-06-05 16:06:04 [http-nio-8015-exec-5] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session adyb5vqd
2025-06-05 16:06:04 [http-nio-8015-exec-5] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 16:06:04 [clientOutboundChannel-118] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@459af66c, simpSessionId=adyb5vqd}], simpSessionId=adyb5vqd}]
2025-06-05 16:06:04 [clientOutboundChannel-119] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=adyb5vqd}], simpSessionId=adyb5vqd}]
2025-06-05 16:06:04 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 16:06:04 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749110764210
2025-06-05 16:06:04 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 16:06:04 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/939/ohvs12iz/websocket
2025-06-05 16:06:04 [http-nio-8015-exec-10] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=ohvs12iz]
2025-06-05 16:06:04 [clientOutboundChannel-120] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 16:06:04 [http-nio-8015-exec-3] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 16:06:04 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 16:06:04 [clientInboundChannel-179] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=ohvs12iz, lookupDestination='/chat.joinRoom'
2025-06-05 16:06:04 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 16:06:04 [clientInboundChannel-179] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 16:06:04 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 16:06:04 [clientInboundChannel-179] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 16:06:04 [clientInboundChannel-179] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 16:06:04 [clientInboundChannel-179] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 16:06:04 [clientInboundChannel-179] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T16:06:04.324712100]
2025-06-05 16:06:04 [clientInboundChannel-179] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 16:06:04 [clientInboundChannel-179] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 16:06:04 [clientInboundChannel-179] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 16:06:04 [clientInboundChannel-179] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 16:06:04 [clientInboundChannel-179] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 16:06:04 [clientInboundChannel-179] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 16:06:04 [clientInboundChannel-179] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749110764322]
2025-06-05 16:06:04 [clientInboundChannel-179] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 16:06:04 [clientInboundChannel-179] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T16:06:04.324712100]
2025-06-05 16:06:04 [http-nio-8015-exec-3] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 16:06:04 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 16:06:04 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 16:06:04 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 16:06:04 [http-nio-8015-exec-3] INFO  c.e.demo.service.ChatMessageService - 成功獲取 48 條消息
2025-06-05 16:06:04 [http-nio-8015-exec-3] INFO  c.e.d.controller.ChatRoomController - 成功獲取 48 條消息
2025-06-05 16:06:05 [http-nio-8015-exec-7] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=ohvs12iz] closed with CloseStatus[code=1000, reason=null]
2025-06-05 16:06:05 [http-nio-8015-exec-7] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session ohvs12iz
2025-06-05 16:06:05 [http-nio-8015-exec-7] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 16:06:05 [clientOutboundChannel-123] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@188a161f, simpSessionId=ohvs12iz}], simpSessionId=ohvs12iz}]
2025-06-05 16:06:05 [clientOutboundChannel-124] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=ohvs12iz}], simpSessionId=ohvs12iz}]
2025-06-05 16:06:11 [MessageBroker-6] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 2 sessions: [ohvs12iz, adyb5vqd]
2025-06-05 16:06:23 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 16:06:23 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749110783378
2025-06-05 16:06:23 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 16:06:23 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/773/jbkbc2er/websocket
2025-06-05 16:06:23 [http-nio-8015-exec-4] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=jbkbc2er]
2025-06-05 16:06:23 [clientOutboundChannel-125] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 16:06:23 [clientInboundChannel-146] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=jbkbc2er, lookupDestination='/chat.joinRoom'
2025-06-05 16:06:23 [clientInboundChannel-146] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 16:06:23 [clientInboundChannel-146] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 16:06:23 [http-nio-8015-exec-7] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 16:06:23 [http-nio-8015-exec-6] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 16:06:23 [clientInboundChannel-146] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 16:06:23 [clientInboundChannel-146] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 16:06:23 [clientInboundChannel-146] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T16:06:23.450651300]
2025-06-05 16:06:23 [clientInboundChannel-146] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 16:06:23 [clientInboundChannel-146] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 16:06:23 [clientInboundChannel-146] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 16:06:23 [clientInboundChannel-146] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 16:06:23 [clientInboundChannel-146] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 16:06:23 [clientInboundChannel-146] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 16:06:23 [clientInboundChannel-146] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749110783448]
2025-06-05 16:06:23 [clientInboundChannel-146] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 16:06:23 [clientInboundChannel-146] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T16:06:23.450651300]
2025-06-05 16:06:23 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 16:06:23 [http-nio-8015-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 16:06:23 [http-nio-8015-exec-7] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 16:06:23 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 16:06:23 [http-nio-8015-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 16:06:23 [http-nio-8015-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 16:06:23 [http-nio-8015-exec-7] INFO  c.e.demo.service.ChatMessageService - 成功獲取 50 條消息
2025-06-05 16:06:23 [http-nio-8015-exec-7] INFO  c.e.d.controller.ChatRoomController - 成功獲取 50 條消息
2025-06-05 16:06:35 [clientInboundChannel-150] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.sendMessage session=r2qzlamr, lookupDestination='/chat.sendMessage'
2025-06-05 16:06:35 [clientInboundChannel-150] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#sendMessage[1 args]
2025-06-05 16:06:35 [clientInboundChannel-150] INFO  c.e.d.c.ChatWebSocketController - 收到訊息: 252552 from Leo in room 1
2025-06-05 16:06:35 [clientInboundChannel-150] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 16:06:35 [clientInboundChannel-150] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [252552]
2025-06-05 16:06:35 [clientInboundChannel-150] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T16:06:35.695953300]
2025-06-05 16:06:35 [clientInboundChannel-150] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 16:06:35 [clientInboundChannel-150] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 16:06:35 [clientInboundChannel-150] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 16:06:35 [clientInboundChannel-150] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 16:06:35 [clientInboundChannel-150] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 16:06:35 [clientInboundChannel-150] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 16:06:35 [clientInboundChannel-150] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749110795693]
2025-06-05 16:06:35 [clientInboundChannel-150] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [CHAT]
2025-06-05 16:06:35 [clientInboundChannel-150] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T16:06:35.695953300]
2025-06-05 16:06:35 [clientInboundChannel-150] INFO  c.e.d.c.ChatWebSocketController - 訊息已儲存: 51
2025-06-05 16:06:39 [http-nio-8015-exec-9] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=jbkbc2er] closed with CloseStatus[code=1000, reason=null]
2025-06-05 16:06:39 [http-nio-8015-exec-9] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session jbkbc2er
2025-06-05 16:06:39 [http-nio-8015-exec-9] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 16:06:39 [clientOutboundChannel-130] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@59c311f1, simpSessionId=jbkbc2er}], simpSessionId=jbkbc2er}]
2025-06-05 16:06:39 [clientOutboundChannel-131] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=jbkbc2er}], simpSessionId=jbkbc2er}]
2025-06-05 16:06:39 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 16:06:39 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749110799154
2025-06-05 16:06:39 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@f821779
2025-06-05 16:06:39 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/263/c1cf2iyv/websocket
2025-06-05 16:06:39 [http-nio-8015-exec-2] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=c1cf2iyv]
2025-06-05 16:06:39 [clientOutboundChannel-132] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 16:06:39 [clientInboundChannel-163] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=c1cf2iyv, lookupDestination='/chat.joinRoom'
2025-06-05 16:06:39 [clientInboundChannel-163] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 16:06:39 [clientInboundChannel-163] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 16:06:39 [clientInboundChannel-163] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 16:06:39 [clientInboundChannel-163] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 16:06:39 [clientInboundChannel-163] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T16:06:39.228854800]
2025-06-05 16:06:39 [clientInboundChannel-163] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 16:06:39 [clientInboundChannel-163] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 16:06:39 [http-nio-8015-exec-5] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 16:06:39 [clientInboundChannel-163] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 16:06:39 [clientInboundChannel-163] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 16:06:39 [clientInboundChannel-163] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 16:06:39 [clientInboundChannel-163] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 16:06:39 [clientInboundChannel-163] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749110799227]
2025-06-05 16:06:39 [clientInboundChannel-163] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 16:06:39 [clientInboundChannel-163] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T16:06:39.228854800]
2025-06-05 16:06:39 [http-nio-8015-exec-7] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 16:06:39 [http-nio-8015-exec-5] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 16:06:39 [http-nio-8015-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 16:06:39 [http-nio-8015-exec-5] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 16:06:39 [http-nio-8015-exec-5] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 16:06:39 [http-nio-8015-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 16:06:39 [http-nio-8015-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 16:06:39 [http-nio-8015-exec-5] INFO  c.e.demo.service.ChatMessageService - 成功獲取 50 條消息
2025-06-05 16:06:39 [http-nio-8015-exec-5] INFO  c.e.d.controller.ChatRoomController - 成功獲取 50 條消息
2025-06-05 16:06:46 [MessageBroker-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [jbkbc2er]
2025-06-05 16:20:39 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Starting SpringWebsocket3Application using Java 17.0.11 with PID 52836 (D:\WorkSpace\SpringTset\SpringTest\Spring_Websocket3\build\classes\java\main started by Jared in D:\WorkSpace\SpringTset\SpringTest)
2025-06-05 16:20:39 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - No active profile set, falling back to 1 default profile: "default"
2025-06-05 16:20:39 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-06-05 16:20:39 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JDBC repositories in DEFAULT mode.
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JDBC - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a JDBC repository, consider annotating your entities with one of these annotations: org.springframework.data.relational.core.mapping.Table.
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 27 ms. Found 0 JDBC repository interfaces.
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 63 ms. Found 2 JPA repository interfaces.
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatMessageRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.example.demo.repository.ChatRoomRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-06-05 16:20:40 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 2 ms. Found 0 Redis repository interfaces.
2025-06-05 16:20:40 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8015 (http)
2025-06-05 16:20:40 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-05 16:20:40 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.41]
2025-06-05 16:20:40 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-05 16:20:40 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1486 ms
2025-06-05 16:20:41 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-05 16:20:41 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.15.Final
2025-06-05 16:20:41 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-05 16:20:42 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-05 16:20:42 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-05 16:20:42 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@4c33fd3b
2025-06-05 16:20:42 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-05 16:20:42 [restartedMain] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-05 16:20:42 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 16.3
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-06-05 16:20:42 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-05 16:20:42 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-05 16:20:43 [restartedMain] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-05 16:20:44 [restartedMain] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-06-05 16:20:44 [restartedMain] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-05 16:20:44 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.ChatRoomController:
	
2025-06-05 16:20:44 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.ChatWebSocketController:
	{[MESSAGE],[/chat.leaveRoom]}: leaveRoom(ChatMessage)
	{[MESSAGE],[/chat.joinRoom]}: joinRoom(ChatMessage,SimpMessageHeaderAccessor)
	{[MESSAGE],[/chat.sendMessage]}: sendMessage(ChatMessage)
2025-06-05 16:20:44 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.FileUploadController:
	
2025-06-05 16:20:44 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.e.d.c.WebController:
	
2025-06-05 16:20:44 [restartedMain] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-06-05 16:20:44 [restartedMain] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page template: index
2025-06-05 16:20:45 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-06-05 16:20:45 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-05 16:20:45 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@6df5fddf]]
2025-06-05 16:20:45 [restartedMain] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-05 16:20:45 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8015 (http) with context path '/'
2025-06-05 16:20:45 [restartedMain] INFO  c.e.demo.SpringWebsocket3Application - Started SpringWebsocket3Application in 6.174 seconds (process running for 9.334)
2025-06-05 16:20:46 [http-nio-8015-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-05 16:20:46 [http-nio-8015-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-05 16:20:46 [http-nio-8015-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-05 16:20:46 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6fabe659
2025-06-05 16:20:46 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6fabe659
2025-06-05 16:20:46 [http-nio-8015-exec-2] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749111646894
2025-06-05 16:20:46 [http-nio-8015-exec-1] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749111646897
2025-06-05 16:20:46 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6fabe659
2025-06-05 16:20:46 [http-nio-8015-exec-3] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/023/2dzjjv1t/websocket
2025-06-05 16:20:47 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=2dzjjv1t]
2025-06-05 16:20:47 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6fabe659
2025-06-05 16:20:47 [http-nio-8015-exec-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/031/oofovfxo/websocket
2025-06-05 16:20:47 [http-nio-8015-exec-4] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=oofovfxo]
2025-06-05 16:20:47 [clientOutboundChannel-2] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 16:20:47 [clientOutboundChannel-1] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 16:20:47 [clientInboundChannel-14] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=oofovfxo, lookupDestination='/chat.joinRoom'
2025-06-05 16:20:47 [clientInboundChannel-13] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=2dzjjv1t, lookupDestination='/chat.joinRoom'
2025-06-05 16:20:47 [clientInboundChannel-14] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 16:20:47 [clientInboundChannel-13] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 16:20:47 [http-nio-8015-exec-9] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 16:20:47 [clientInboundChannel-14] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 16:20:47 [clientInboundChannel-13] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 16:20:47 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 16:20:47 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 16:20:47 [http-nio-8015-exec-8] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 16:20:47 [clientInboundChannel-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 16:20:47 [clientInboundChannel-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 16:20:47 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 16:20:47 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 16:20:47 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T16:20:47.118100700]
2025-06-05 16:20:47 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T16:20:47.118100700]
2025-06-05 16:20:47 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 16:20:47 [http-nio-8015-exec-9] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 16:20:47 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 16:20:47 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 16:20:47 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 16:20:47 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 16:20:47 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 16:20:47 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 16:20:47 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 16:20:47 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 16:20:47 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 16:20:47 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749111647105]
2025-06-05 16:20:47 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 16:20:47 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 16:20:47 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 16:20:47 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749111647105]
2025-06-05 16:20:47 [clientInboundChannel-13] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T16:20:47.118100700]
2025-06-05 16:20:47 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 16:20:47 [clientInboundChannel-14] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T16:20:47.118100700]
2025-06-05 16:20:47 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 16:20:47 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 16:20:47 [http-nio-8015-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 16:20:47 [http-nio-8015-exec-9] INFO  c.e.demo.service.ChatMessageService - 成功獲取 50 條消息
2025-06-05 16:20:47 [http-nio-8015-exec-9] INFO  c.e.d.controller.ChatRoomController - 成功獲取 50 條消息
2025-06-05 16:20:47 [http-nio-8015-exec-10] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 16:20:47 [http-nio-8015-exec-2] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 16:20:47 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 16:20:47 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 16:20:47 [http-nio-8015-exec-2] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 16:20:47 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 16:20:47 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 16:20:47 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 16:20:47 [http-nio-8015-exec-2] INFO  c.e.demo.service.ChatMessageService - 成功獲取 50 條消息
2025-06-05 16:20:47 [http-nio-8015-exec-2] INFO  c.e.d.controller.ChatRoomController - 成功獲取 50 條消息
2025-06-05 16:20:55 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=oofovfxo] closed with CloseStatus[code=1000, reason=null]
2025-06-05 16:20:55 [http-nio-8015-exec-3] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session oofovfxo
2025-06-05 16:20:55 [clientOutboundChannel-7] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@2a05a842, simpSessionId=oofovfxo}], simpSessionId=oofovfxo}]
2025-06-05 16:20:55 [http-nio-8015-exec-3] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 16:20:55 [clientOutboundChannel-8] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=oofovfxo}], simpSessionId=oofovfxo}]
2025-06-05 16:20:55 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6fabe659
2025-06-05 16:20:55 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749111655601
2025-06-05 16:20:55 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6fabe659
2025-06-05 16:20:55 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/732/ngru0iqk/websocket
2025-06-05 16:20:55 [http-nio-8015-exec-7] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=ngru0iqk]
2025-06-05 16:20:55 [clientOutboundChannel-9] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 16:20:55 [clientInboundChannel-31] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=ngru0iqk, lookupDestination='/chat.joinRoom'
2025-06-05 16:20:55 [http-nio-8015-exec-2] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 16:20:55 [clientInboundChannel-31] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 16:20:55 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 16:20:55 [clientInboundChannel-31] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 16:20:55 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 16:20:55 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 16:20:55 [clientInboundChannel-31] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 16:20:55 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 16:20:55 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T16:20:55.718056100]
2025-06-05 16:20:55 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 16:20:55 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 16:20:55 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 16:20:55 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 16:20:55 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 16:20:55 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 16:20:55 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749111655715]
2025-06-05 16:20:55 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 16:20:55 [clientInboundChannel-31] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T16:20:55.718056100]
2025-06-05 16:20:55 [http-nio-8015-exec-2] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 16:20:55 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 16:20:55 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 16:20:55 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 16:20:55 [http-nio-8015-exec-2] INFO  c.e.demo.service.ChatMessageService - 成功獲取 50 條消息
2025-06-05 16:20:55 [http-nio-8015-exec-2] INFO  c.e.d.controller.ChatRoomController - 成功獲取 50 條消息
2025-06-05 16:21:01 [MessageBroker-4] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [oofovfxo]
2025-06-05 16:21:06 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=2dzjjv1t] closed with CloseStatus[code=1000, reason=null]
2025-06-05 16:21:06 [http-nio-8015-exec-3] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session 2dzjjv1t
2025-06-05 16:21:06 [http-nio-8015-exec-3] INFO  c.e.demo.config.WebSocketConfig - User Leo disconnected from room 1
2025-06-05 16:21:06 [clientOutboundChannel-12] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Leo}, simpHeartbeat=[J@382c97de, simpSessionId=2dzjjv1t}], simpSessionId=2dzjjv1t}]
2025-06-05 16:21:06 [clientOutboundChannel-13] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Leo}, simpSessionId=2dzjjv1t}], simpSessionId=2dzjjv1t}]
2025-06-05 16:21:06 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6fabe659
2025-06-05 16:21:06 [http-nio-8015-exec-6] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749111666808
2025-06-05 16:21:06 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6fabe659
2025-06-05 16:21:06 [http-nio-8015-exec-7] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/182/cebhyfio/websocket
2025-06-05 16:21:06 [http-nio-8015-exec-7] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=cebhyfio]
2025-06-05 16:21:06 [clientOutboundChannel-14] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 16:21:06 [clientInboundChannel-46] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=cebhyfio, lookupDestination='/chat.joinRoom'
2025-06-05 16:21:06 [http-nio-8015-exec-9] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 16:21:06 [clientInboundChannel-46] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 16:21:06 [clientInboundChannel-46] INFO  c.e.d.c.ChatWebSocketController - 用戶 Jared 加入房間 1
2025-06-05 16:21:06 [http-nio-8015-exec-2] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 16:21:06 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 16:21:06 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 16:21:06 [clientInboundChannel-46] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 16:21:06 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Jared 加入了聊天室]
2025-06-05 16:21:06 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T16:21:06.920439500]
2025-06-05 16:21:06 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 16:21:06 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 16:21:06 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 16:21:06 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 16:21:06 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 16:21:06 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Jared]
2025-06-05 16:21:06 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749111666918]
2025-06-05 16:21:06 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 16:21:06 [clientInboundChannel-46] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T16:21:06.920439500]
2025-06-05 16:21:06 [http-nio-8015-exec-2] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 16:21:06 [http-nio-8015-exec-2] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 16:21:06 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 16:21:06 [http-nio-8015-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 16:21:06 [http-nio-8015-exec-2] INFO  c.e.demo.service.ChatMessageService - 成功獲取 50 條消息
2025-06-05 16:21:06 [http-nio-8015-exec-2] INFO  c.e.d.controller.ChatRoomController - 成功獲取 50 條消息
2025-06-05 16:21:08 [http-nio-8015-exec-3] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=cebhyfio] closed with CloseStatus[code=1000, reason=null]
2025-06-05 16:21:08 [http-nio-8015-exec-3] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - Clearing session cebhyfio
2025-06-05 16:21:08 [http-nio-8015-exec-3] INFO  c.e.demo.config.WebSocketConfig - User Jared disconnected from room 1
2025-06-05 16:21:08 [clientOutboundChannel-17] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={roomId=1, username=Jared}, simpHeartbeat=[J@4d1cfd43, simpSessionId=cebhyfio}], simpSessionId=cebhyfio}]
2025-06-05 16:21:08 [clientOutboundChannel-18] DEBUG o.s.w.s.m.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true, roomId=1, username=Jared}, simpSessionId=cebhyfio}], simpSessionId=cebhyfio}]
2025-06-05 16:21:11 [MessageBroker-8] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [2dzjjv1t]
2025-06-05 16:21:16 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6fabe659
2025-06-05 16:21:16 [http-nio-8015-exec-10] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/info?t=1749111676984
2025-06-05 16:21:16 [MessageBroker-11] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Closed 1 sessions: [cebhyfio]
2025-06-05 16:21:17 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.s.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6fabe659
2025-06-05 16:21:17 [http-nio-8015-exec-9] DEBUG o.s.w.s.s.t.h.DefaultSockJsService - Processing transport request: GET http://localhost:8015/ws/851/ne1mqn3f/websocket
2025-06-05 16:21:17 [http-nio-8015-exec-9] DEBUG o.s.w.s.h.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=ne1mqn3f]
2025-06-05 16:21:17 [clientOutboundChannel-19] INFO  c.e.demo.config.WebSocketConfig - WebSocket connection established
2025-06-05 16:21:17 [clientInboundChannel-15] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Searching methods to handle SEND /app/chat.joinRoom session=ne1mqn3f, lookupDestination='/chat.joinRoom'
2025-06-05 16:21:17 [clientInboundChannel-15] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - Invoking ChatWebSocketController#joinRoom[2 args]
2025-06-05 16:21:17 [clientInboundChannel-15] INFO  c.e.d.c.ChatWebSocketController - 用戶 Leo 加入房間 1
2025-06-05 16:21:17 [http-nio-8015-exec-4] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.is_active 
    order by
        cr1_0.created_at desc
2025-06-05 16:21:17 [http-nio-8015-exec-3] INFO  c.e.d.controller.ChatRoomController - 獲取房間 1 的消息，限制 50 條
2025-06-05 16:21:17 [clientInboundChannel-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        chat_messages
        (content, created_at, file_name, file_size, file_type, file_url, room_id, sender, timestamp, message_type, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-06-05 16:21:17 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Leo 加入了聊天室]
2025-06-05 16:21:17 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:TIMESTAMP) <- [2025-06-05T16:21:17.062538500]
2025-06-05 16:21:17 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2025-06-05 16:21:17 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [null]
2025-06-05 16:21:17 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2025-06-05 16:21:17 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2025-06-05 16:21:17 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [1]
2025-06-05 16:21:17 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:VARCHAR) <- [Leo]
2025-06-05 16:21:17 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:BIGINT) <- [1749111677059]
2025-06-05 16:21:17 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:VARCHAR) <- [JOIN]
2025-06-05 16:21:17 [clientInboundChannel-15] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:TIMESTAMP) <- [2025-06-05T16:21:17.062538500]
2025-06-05 16:21:17 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cr1_0.id,
        cr1_0.created_at,
        cr1_0.creator,
        cr1_0.description,
        cr1_0.is_active,
        cr1_0.member_count,
        cr1_0.name,
        cr1_0.updated_at 
    from
        chat_rooms cr1_0 
    where
        cr1_0.id=?
2025-06-05 16:21:17 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2025-06-05 16:21:17 [http-nio-8015-exec-3] INFO  c.e.demo.service.ChatMessageService - 獲取房間 1 的最近 50 條消息
2025-06-05 16:21:17 [http-nio-8015-exec-3] DEBUG org.hibernate.SQL - 
    select
        cm1_0.id,
        cm1_0.content,
        cm1_0.created_at,
        cm1_0.file_name,
        cm1_0.file_size,
        cm1_0.file_type,
        cm1_0.file_url,
        cm1_0.room_id,
        cm1_0.sender,
        cm1_0.timestamp,
        cm1_0.message_type,
        cm1_0.updated_at 
    from
        chat_messages cm1_0 
    where
        cm1_0.room_id=? 
    order by
        cm1_0.timestamp desc,
        cm1_0.timestamp desc 
    fetch
        first ? rows only
2025-06-05 16:21:17 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [1]
2025-06-05 16:21:17 [http-nio-8015-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [50]
2025-06-05 16:21:17 [http-nio-8015-exec-3] INFO  c.e.demo.service.ChatMessageService - 成功獲取 50 條消息
2025-06-05 16:21:17 [http-nio-8015-exec-3] INFO  c.e.d.controller.ChatRoomController - 成功獲取 50 條消息
2025-06-05 16:21:45 [MessageBroker-18] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 5 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(5)-CONNECTED(5)-DISCONNECT(3)], stompBrokerRelay[null], inboundChannel[pool size = 48, active threads = 0, queued tasks = 0, completed tasks = 63], outboundChannel[pool size = 21, active threads = 0, queued tasks = 0, completed tasks = 21], sockJsScheduler[pool size = 24, active threads = 1, queued tasks = 3, completed tasks = 14]
